<!DOCTYPE html>
<html lang="en">
    <head> 
      <meta charset="UTF-8">  
      <meta http-equiv='cache-control' content='no-cache'>
      <meta http-equiv='expires' content='0'>
      <meta http-equiv='pragma' content='no-cache'>
      <!--<meta name="viewport" content="width=device-width, user-scalable=yes, minimum-scale=1.0, maximum-scale=1.0">-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">

     

      <!--<link type="text/css" rel="stylesheet" href="../static/main.css">-->

      
      <title>Automate assembly</title> 
       <!--Get the data container of the project list and email account to check the hardware correctness -->
		  <!--Get the email account id data--> 
      <input type="hidden" id="email_account" value="{{userdata}}"> <!--Get the user data input--> 
      <input type="hidden" id="encode_jwt" value="{{encodejwt}}"> <!--Passing jwt encode data--> 
      <input type="hidden" id="project_payload" value="{{payload_project_list}}"> <!--Passing the project data from the link -->
      <input type="hidden" id="projectname_data" value="{{projectnamedata}}">
      <input type="hidden" id="project_descrp" value="{{project_descript}}">
      <input type="hidden" id="languageset" value="{{valueset_lang}}">
      <input type="hidden" id ="component_nav" value="{{component_project}}">     
      <input type="hidden" id="video_frame" value="{{video_realtime}}">
      <input type="hidden" id="audioduration" value="{{audio_duration}}">
      <input type="hidden" id="current_audio" value="{{current_audiodat}}">
      <input type="hidden" id = "store_control" value="{{store_controls}}">
      <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
      <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

      <!--Adding the notify-->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
      <link rel='stylesheet' href='//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css'>
      <!--<link rel='stylesheet' href='//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css'>-->


      <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css'>
      <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
      <script src='https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js'></script>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
      <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script> 
      <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>-->
      <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
      <link rel="stylesheet" href="../static/aichat.css">
      
      <!--
      <input type="hidden" id="email" value="{{useraccount}}">
  <input type="hidden" id="encode_jwt" value="{{encodejwt}}">
      var email = document.getElementById("email").value;
    var encode_jwt = document.getElementById("encode_jwt").value
      -->
    </head>
    
    <style>
              body {background-color: #000000; /* Black background */
                   margin: 0; 
                   padding:0;
                  }
              canvas { display: block; }

              .label {
               position: absolute;
               width:relative; 
               height:relative;
               background-color: rgba(0, 0, 0, 0.7);
               color: #fff;
               font-family: Arial, sans-serif;
               font-size: 12px;
               padding: 4px 8px;
               border-radius: 4px;
     }
    
     .label3 {
          color: #fff;
          font-size: 12px;
          background: rgba(0, 0, 0, 0.5);
          padding: 2px 4px;
          border-radius: 3px;
      }

	</style>
  <style>
      .context-menu {
            display: none;
            position: absolute;
            background-color: #ffffff;
            border: 1px solid #ccc;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            width: 150px;
            border-radius: 5px;
            overflow: hidden;
        }

        .context-menu ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .context-menu ul li {
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .context-menu ul li:hover {
            background-color: #f0f0f0;
        }

        .context-menu ul li:active {
            background-color: #e0e0e0;
        }
  </style>

    <style>
      .toast-slider {
        position: fixed;
        bottom: 20px;
        right: 20px;
        max-width: 300px;
        overflow: hidden;
        z-index: 9999;
      }
  
      .toast-slider .toast {
        cursor: pointer;
        padding: 10px;
        margin-bottom: 10px;
        background-color: #333;
        color: #fff;
        transition: all 0.3s ease;
      }
  
      .toast-slider .toast:hover {
        background-color: #555;
      }
  
      .scrollable-content {
        max-height: 100px; /* Adjust as needed */
        overflow-y: auto;
      }
      .toast-loading::after { /* Loading processing task to let the user know the status of current system*/
            content: "‚è≥";
            margin-left: 10px;
            animation: spin 1s infinite linear;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        /* Style the iframe container to take up full width and height */
  #iframe-container {
      padding-top: 2px;
      padding-left: 0px;
      width: 100%;
      height: 100vh; /* Set the height to viewport height */
      overflow: hidden; /* Hide any overflow content */
      position: relative;
  }

  /* Style the iframe itself to fill the container */
  #iframe-container iframe {
      width: 100%;
      height: 100%;
      border: 10; /* Optional: Remove iframe border */
      
  }
  #iframe-container2 {
      padding-top: 2px;
      padding-left: 0px;
      width: 100%;
      height: 100vh; /* Set the height to viewport height */
      overflow: hidden; /* Hide any overflow content */
      position: relative;
  }
  /* Style the iframe itself to fill the container */
  #iframe-container2 iframe {
      width: 100%;
      height: 100%;
      border: 10; /* Optional: Remove iframe border */
      
  }
  .navbar {
     /* Set the position to fixed */
    top: -30; /* Stick it to the top of the viewport */
    left: 0; /* Stick it to the left of the viewport */
    width: 70%; /* Make it span the entire width of the viewport */
    background-color: #333; /* Styling for the background color */
    color: #fff; /* Styling for text color */
    padding: 10px; /* Add padding for spacing */
    z-index: 1000; /* Set a z-index to control the stacking order (higher values are on top) */
}
.city {display:none}

    </style>
     <style>
      /* Custom style for the select box */
      .my-custom-select-box select {
        color: black; /* Change the text color */
        background-color: #f0f0f0; /* Change background color */
      }
    </style>
   <style>
       
    /* Modal styles */
    .modal3 {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        justify-content: center; /* Center content vertically */
        align-items: center; /* Center content horizontally */
    }
     
    .modal-content3 {
        background-color: #fefefe;
        margin: 15% auto; /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 90%; /* Could be more or less, depending on screen size */
    }
    .modal4 {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }
    .modal-content4 {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 1200px;
            border-radius: 8px;
    } 
    .close4 {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        /* Tab styles */
     .tab4 {
            display: flex;
            border-bottom: 1px solid #ccc;
     }
     .tab4 button {
            background-color: inherit;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 10px 16px;
            transition: background-color 0.3s;
            flex-grow: 1;
        }

        .tab4 button:hover {
            background-color: #ddd;
        }

        .tab4 button.active {
            background-color: #ccc;
        }

        .tab-content4 {
            display: none;
            padding: 10px;
            border-top: none;
        }

        .tab-content4.active {
            display: block;
        }

        .interactive-button4 {
            margin-top: 10px;
            padding: 8px 12px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        
        .interactive-button4:hover {
            background-color: #0056b3;
        }
        /*
        #radarChart {
            width: 30%;  
            height: 30%;
            margin: 0;
        }
        */
        #radarChart {
            width: 100%; /* Full width of the parent container */
    height: 100%; /* Full height of the parent container */
    max-width: 600px; /* Optional: cap the maximum width */
    max-height: 400px; /* Optional: cap the maximum height */
    margin: auto; /* Center alignment */
        }
    
    .slider-container3 {
        width: 100%;
        overflow-x: auto;
        white-space: nowrap;
        border: 2px solid #ccc; /* Optional border for better visibility */
    }

    .slider3 {
        display: flex; /* Use flexbox for horizontal layout */
    }

    .frame3 {
        min-width: 300px; /* Set the width of each iframe frame */
        height: 200px; /* Set the height of the iframe */
        margin-right: 10px; /* Space between frames */
        border: 1px solid #aaa; /* Optional border for frames */
    }
    .center-text {
            text-align: center;
        }
    
</style> 
<style>
  /*
  .chat-container {
    position: fixed;
    bottom: 35px; 
    right: 20px;
    width: 320px;
    height: 460px;
    max-height: calc(100vh - 40px);
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
    overflow: hidden;

  }
  */
  .chat-container {
    display: flex;
    flex-flow: column wrap;
    justify-content: space-between;
    width: 100%;
    max-width: 60px;
    height: 0px; /* Matches the height from .msger */
    margin: 10px;
    border: 1px solid #ddd; /* Assuming this matches your var(--border) */
    border-radius: 5px;
    background-color: #f9f9f9; /* Adjust to match your var(--msger-bg) */
    box-shadow: 0 15px 15px -5px rgba(0, 0, 0, 0.2);
    position: fixed;
    top: 0px;
    right: 10px;
    z-index: 1000;
  }
  .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    /* ... */
  }
  /*
  .chat-container.minimized {
    width: 60px;
    height: 60px;
    border-radius: 30px;
    overflow: hidden;
  }*/
  .chat-container.minimized {
  width: 60px;
  height: 60px;
  border-radius: 30px;
  overflow: hidden;
  position: fixed;
  top: 400px; /* Distance from the top of the screen */
  left: 93%; /* Center horizontally */
  transform: translateX(-50%); /* Offset by half its own width */
  z-index: 1000; /* Ensure it's above other elements */
}

/* Media query for smaller screens */
@media screen and (max-width: 768px) {
  .chat-container.minimized {
    top: 10px; /* Adjust top position for smaller screens if needed */
  }
}

  .chat-container.maximized {
    width: 100%;
    height: 100vh;
    max-height: 100vh;
    bottom: 0;
    right: 0;
    border-radius: 0;
  }

  .chat-container.minimized .msger {
    display: none;
  }

  .chat-container.minimized .chat-bubble {
  display: flex;
  width: 100%;
  height: 100%;
  justify-content: center;
  align-items: center;
  background-color: #0084ff;
  cursor: pointer;
}

.chat-bubble {
  display: none;
}

.chat-bubble .profile-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 50%;
}
  .msger {
    display: flex;
    flex-direction: column;
    height: 60%;
    width: 100%;
  }

  .msger-header {
    padding: 10px;
    background-color: #f1f1f1;
    border-bottom: 1px solid #ddd;
  }

  .msger-chat {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
  }

  .msger-inputarea {
    display: flex;
    padding: 10px;
    border-top: 1px solid #ddd;
    background-color: #f1f1f1;
  }

  .msger-input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 3px;
    font-size: 1em;
  }

  .msger-send-btn {
    margin-left: 10px;
    background: #0084ff;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.23s;
  }

  .minimize-btn, .maximize-btn {
    background: none;
    border: none;
    font-size: 18px;
    cursor: pointer;
    margin-left: 5px;
  }

  .msg {
    display: flex;
    align-items: flex-end;
    margin-bottom: 10px;
  }

  .msg:last-of-type {
    margin: 0;
  }

  .msg-img {
    width: 50px;
    height: 50px;
    margin-right: 10px;
    background-repeat: no-repeat;
    background-position: center;
    background-size: cover;
    border-radius: 50%;
  }

  .msg-bubble {
    max-width: 400px;
    padding: 15px;
    border-radius: 15px;
    background: #ececec;
  }

  .msg-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .msg-info-name {
    margin-right: 10px;
    font-weight: bold;
  }

  .msg-info-time {
    font-size: 0.85em;
  }

  .left-msg .msg-bubble {
    border-bottom-left-radius: 0;
  }

  .right-msg {
    flex-direction: row-reverse;
  }

  .right-msg .msg-bubble {
    background: #579ffb;
    color: #fff;
    border-bottom-right-radius: 0;
  }

  .right-msg .msg-img {
    margin: 0 0 0 10px;
  }

  @media screen and (max-width: 768px) {
    .msg-img {
      width: 40px;
      height: 40px;
    }

    .msg-bubble {
      max-width: 300px;
    }
  }

  @media screen and (max-width: 480px) {
    .msg-img {
      width: 30px;
      height: 30px;
    }

    .msg-bubble {
      max-width: 250px;
    }
  }

  @media screen and (max-height: 600px) {
    .chat-container {
      height: calc(100vh - 40px);
    }
  }
</style>
    <body>
      <div class="chat-container" id="chatContainer">
        <div class="chat-bubble" id="chatBubble">
          <img src="/static/images_ai/Roboreactor_modern_2_logo.png" alt="Profile" class="profile-image">
        </div>
        <section class="msger">
          <header class="msger-header">
            <div class="msger-header-title">
              <i class="fas fa-comment-alt"></i> Manufacturing assistant AI 
            </div>
            <div class="msger-header-options">
              <span><i class="fas fa-cog"></i></span>
              <button class="minimize-btn" id="minimizeBtn">_</button>
              <!--<button class="maximize-btn" id="maximizeBtn">‚ñ°</button>-->
            </div>
          </header>
    
          <main class="msger-chat">
            <div class="msg left-msg">
              <!--<div class="msg-img" style="background-image:'/static/images_ai/{{account_data}}/Roboreactor_modern_2_logo.png'"></div>
              <div class="msg-bubble">
                <div class="msg-info">
                  <div class="msg-info-name">Manufacturing Assistant</div>
                </div>
                <div class="msg-text">
                  Hi, welcome to Manufacturing assistant chat! Ask me any thing about your robotic project. üòÑ
                </div>
              </div>-->
            </div>
          </main>
    
          <form class="msger-inputarea">
            <input type="text" class="msger-input" placeholder="Ask me any thing about robotic project">
            <button type="submit" class="msger-send-btn">‚ÜñÔ∏è</button>
          </form>
        </section>
     </div>
     <!--Open the modal for the real time multi agent task display-->
     <div id="modal" class="modal4">
     <div class="modal-content4">
          <span class="close4" onclick="closeModal()">&times;</span>

          <!-- Tab Navigation -->
          <div id="tabContainer" class="tab4"></div>

          <!-- Tab Content Container -->
          <div id="tabContentContainer"></div>
      </div>
     </div>

     <div id="components_modal" class="modal3">
        <div class="modal-content3">
         
            <div class="slider-container3">
                <div class="slider3" id="components-slider">
                   
                </div>
            </div>
        </div>
    </div> 
      <div class="w3-container">
        <div id="id01" class="w3-modal">
          <div class="w3-modal-content w3-card-4 w3-animate-zoom">
           <header class="w3-container w3-white"> 
            <span onclick="document.getElementById('id01').style.display='none'" 
            class="w3-button w3-white w3-xsmall w3-display-topleft">&times;</span>
            <h5 class="center-text" >Project manager</h5> <!--Call the project name from the id input-->
           </header>
          
         
           <div class="w3-bar w3-border-bottom">
            <button class="tablink w3-bar-item w3-button" onclick="openCity(event, 'projprofile');fetch_head();">Project profile</button>
            <button class="tablink w3-bar-item w3-button" onclick="openCity(event, 'components');fetch_project();">Components selection</button> <!--fetch_project-->
            <button class="tablink w3-bar-item w3-button" onclick="openCity(event, 'components_features');fetch_codefeature();">Generated features</button>
            <button class="tablink w3-bar-item w3-button" onclick="openCity(event, 'code');fetch_docmatch();">Component doc</button>
            
           </div>

           <div id="projprofile" class="w3-container city">
            <br>  
                <div>  
                 <ul>
                    <h2>Project name</h2> 
                    <input class="form-control addMain" id="projname"  placeholder="Project name"value="{{project_name}}"> 
                    <h2>project description</h2>
                    <input class="form-control addMain" id="projectdesc" placeholder="Project description"value={{project_descyption}}>
                 </ul> 
                 <ul>
                 </ul>
                 
                
                <ul>
                      <button type="button" onClick="Save_edit_data();">Save edit</button>
                </ul>
              
              </div>  <!--http://192.168.50.193:7998/ -->
            </div>
            
 
           <!--User url from the server -->
           <div id="components" class="w3-container city">
             
              <br>    
             
             <div id="iframe-container">
              <!--Passing the data of the json into the new model loader slection to activate the feature generation in the code -->
               <!--<iframe src="https://roboreactor.com/Model_selected/{{userdata}}/Smart_bots/Vision_system/Non" frameborder="10"></iframe>--> <!-- Replace with your URL -->
               <iframe id="componentsloader" src="https://roboreactor.com/components_loader/{{userdata}}" scrolling="no" frameborder="10"></iframe>
            </div>

           </div>
        
          <div id="components_features" class="w3-container city">
            <br>
            <div id="iframe-container2">
          
              <iframe id="docloader" src="https://roboreactor.com/load_selected_features/{{encodejwt}}" scrolling="yes" frameborder="10"></iframe>
            </div>
          </div>

        <div id="code" class="w3-container city">
            <br>
            <div id="iframe-container2">

              <iframe id="projectflowchart" src="https://roboreactor.com/folder_docmatch/{{encodejwt}}" scrolling="yes" frameborder="10"></iframe>

            </div>
           </div>
         
           <div class="w3-container w3-light-grey w3-padding">
            <button class="w3-button w3-right w3-white w3-border" 
            onclick="document.getElementById('id01').style.display='none'">Close</button>
           </div>
          </div>
        </div>
        


      </div>
      <div class="context-menu" id="contextMenu">
        <ul>
            <li id="editdata">Add control</li>
            <li id="movemodelid">Move model</li>
            <li id="rotatemodelid">Rotate model</li>
            <li id="detachcontrol">Detach control</li>
            <li id="deleteid">Remove model</li>
        </ul>
    </div> 
      <!--Get the new tab widget here tof the data visualization of the components prics -->  
       <script>
        let status_select = {}; 
        function status_selected_part(endpoint,payload_status){
                  console.log('Current status payload data'); //Get the current payload status
                  var email = document.getElementById("email_account").value; 
                  let encap_status = {} 
                  encap_status[email] = payload_status; // Get the encap status data to send the payload to the status server 
                    
                  fetch('/'+endpoint, {
                    // Declare what type of data we're sending
                    headers: {
                           'Content-Type': 'application/json'
                    },
                   // Specify the method
                   method: 'POST',
                  // A JSON payload
                  body: JSON.stringify(encap_status)
                  }).then(function (response) { // At this point, Flask has printed our JSON
                  return response.text();
                  }).then(function (text) {
                  console.log('POST response: ');
                  // Should be 'OK' if everything was successful
                  var data_status_select = JSON.parse(text);
                  console.log("Current status data",data_status_select);
                  });

        }
        function fetch_project(){
                  console.log("Extract the project data ....");
                  /*
                  var email = document.getElementById("email_account").value; 
                  //Fetch the id project data here 
                  fetch('/current_projs', {
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({

                                   "email": email
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          var data_projectadd = JSON.parse(text);
                          console.log("Get current project data",data_projectadd); 
                          //Get the current project name update 
                          var iframe = document.getElementById("componentsloader");
                          console.log("Current project name data",data_projectadd['project_name']);
                          document.getElementById("projname").value = data_projectadd['project_name'];    
                          iframe.src = "https://roboreactor.com/components_loader/{{userdata}}"

                          
    });    
    */
    status_select['status'] = 'selected part';
    status_selected_part("selected_part_status",status_select)
    console.log("Fetcheing components selector");
     var iframe = document.getElementById("componentsloader");                     
     iframe.src = "https://roboreactor.com/components_loader/{{userdata}}"
    }
    function fetch_docmatch(){
      status_select['status'] = 'docmatch'
               console.log("Fetching the document data and model matching");
                var email = document.getElementById("email_account").value; 
                  //Fetch the id project data here 
                  fetch('/current_projs', {
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({

                                   "email": email
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          var data_projectadd = JSON.parse(text);
                          console.log("Get current project data",data_projectadd); 
                          //Get the current project name update 
                          var iframe = document.getElementById("projectflowchart");
                          console.log("Current project name data",data_projectadd['project_name']);
                          document.getElementById("projname").value = data_projectadd['project_name'];    
                          iframe.src = "https://roboreactor.com/folder_docmatch/{{encodejwt}}"
                          
                          
    });    
                        
    }
    function fetch_codefeature(){
                //status_select['status'] = 'code feature' 
                console.log("Fetch the generated features selected");
                var email = document.getElementById("email_account").value; 
                  //Fetch the id project data here 
                  fetch('/current_projs', {
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({

                                   "email": email
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          var data_projectadd = JSON.parse(text);
                          console.log("Get current project data",data_projectadd); 
                          //Get the current project name update 
                          var iframe = document.getElementById("docloader");
                          console.log("Current project name data",data_projectadd['project_name']);
                          document.getElementById("projname").value = data_projectadd['project_name'];    
                          iframe.src = "https://roboreactor.com/load_selected_features/{{encodejwt}}"
                          status_select['status'] = 'selected codefeature';
                          status_selected_part("selected_part_status",status_select)   
                          
    });    
    }
        function fetch_head(){
                  status_select['status'] = 'fetch head' 
                  console.log("Extract the project data ....");
                  var email = document.getElementById("email_account").value; 
                  //Fetch the id project data here 
                  fetch('/current_projs', {
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({

                                   "email": email
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          var data_projectadd = JSON.parse(text);
                          console.log("Get current project data",data_projectadd); 
                          //Get the current project name update 
                          //var iframe = document.getElementById("componentsloader");
                          console.log("Current project name data",data_projectadd['project_name']);
                          document.getElementById("projname").value = data_projectadd['project_name'];    
                          //iframe.src = "https://192.168.50.193:5889/components_loader/{{userdata}}"

                          
    });    
        }
        function fetch_pdf(){
                  console.log("Extract the project data ....");
                  var email = document.getElementById("email_account").value; 
                  //Fetch the id project data here 
                  fetch('/current_projs', {
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({

                                   "email": email
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          var data_projectadd = JSON.parse(text);
                          console.log("Get current project data",data_projectadd); 
                          //Get the current project name update 
                          var iframe = document.getElementById("docloader");
                          console.log("Current project name data",data_projectadd['project_name']);
                          //Fetch the first components pdf in the list if the directory 

                          //document.getElementById("projname").value = data_projectadd['project_name'];    
                          iframe.src = "https://roboreactor.com/pdfdocu/{{userdata}}/drv8323.pdf"

                          
    });    
        }  
        function fetch_code(){
                  status_select['status'] = 'fetch code'
                  console.log("Extract the project data ....");
                  var email = document.getElementById("email_account").value; 
                  //Fetch the id project data here 
                  fetch('/current_projs', {
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({

                                   "email": email
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          var data_projectadd = JSON.parse(text);
                          console.log("Get current project data",data_projectadd); 
                          //Get the current project name update 
                          var iframe = document.getElementById("projectflowchart");
                          console.log("Current project name data",data_projectadd['project_name']);
                          //Fetch the first components pdf in the list if the directory 

                          //document.getElementById("projname").value = data_projectadd['project_name'];    
                          iframe.src = "https://roboreactor.com/statechart"

                          
    });    
        }   
        function Save_edit_data(){
              //Get the email account data and get the project name to send back to the back-end and rename data in the project into the name for the directory 
              var email = document.getElementById("email_account").value; 
              var jwt_code = document.getElementById("encode_jwt").value;
              var project_edit_backend = document.getElementById("projname").value;
              console.log("Save edit data",email,project_edit_backend);
              //Fetch to save data of the project name  
              manual_create_project(email,project_edit_backend); //Get the project edit data  
              function manual_create_project(email,projectname_data){
               //Sending back the project description to the back-end 
              fetch('/add_projectname',{
                // Declare what type of data we're sending
                     headers: {
                    'Content-Type': 'application/json'
               },
               // Specify the method
                method: 'POST',
               // A JSON payload
              body: JSON.stringify({
              "email": email,"projectname":projectname_data,"project_descp":document.getElementById('projectdesc').value  // Get the destiny language data to translate back the server reference   
          })
          }).then(function (response) { // At this point, Flask has printed our JSON
         return response.text();
         }).then(function (text) {
          console.log('POST response: ');
          var data_projs= JSON.parse(text); 
          console.log("project data",data_projs);
          if(Object.keys(data_projs[email]) == "Existing_project"){
                           console.log("This project is already created"); // Existing project detected
                           notify_data("success","This project is already created");
                           var date_data = data_projs[email]["Existing_project"][projectname_data];      
                           var datedata = date_data.split(" ")[0]; 
                           var date_extract = date_data.split(" ")[0].split("-")

                           //translate_lang("This project was already created in date "+datedata,value_set)
                           notify_data("success","This project was already created in date "+datedata);
                           //Asking for editing the project 
                           //translate_lang("Do you want to edit project "+projectname_data+"?",value_set); 
                           //Activate the project modal edited 
                           document.getElementById('id01').style.display='block';
                           document.getElementById("projname").value = projectname_data;
                                      
                
          }   
          if(Object.keys(data_projs[email]) != "Existing_project"){
               
                          console.log("This project is now created");
                          notify_data('success','This project is now created');
                          //Activate the project directory to created 
                          //Fetch to create the project data 
                        

          }
         
          


        });
     }
               
              

       }
       //Get the project data notification function to show the project data 
       function notify_data(status,text){
        toastr.options = {
             "closeButton": true,
             "newestOnTop": false,
             "progressBar": true,
             "positionClass": "toast-top-center",
             "preventDuplicates": false,
             "onclick": null,
             "showDuration": "300",
             "hideDuration": "1000",
             "timeOut": "5000",
             "extendedTimeOut": "1000",
             "showEasing": "swing",
             "hideEasing": "linear",
             "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
           }
           if(status == 'success'){
              toastr.success(text); // if status success 
           }
           if(status == 'warning'){
              toastr.warning(text); 
           }
           if(status == 'error'){
              toastr.error(text); 
           }
            
  }
  let toastInstance = null;

        // Function to Show Loading Toast
        function startLoading() {
            if (toastInstance) return; // Prevent multiple instances

            toastInstance = Toastify({
                text: "Loading... Please wait",
                duration: -1, // Keep toast open indefinitely
                close: false, // Disable manual close
                gravity: "top", // top or bottom
                position: "center", // left, center, or right
                backgroundColor: "#FFA500", // Orange background for loading
                stopOnFocus: true,
                className: "toast-loading" // Apply spinner animation
            }).showToast();
        }

        // Function to Stop Loading Toast
        function stopLoading() {
            if (toastInstance) {
                toastInstance.hideToast(); // Hide the toast
                toastInstance = null; // Clear the instance
            }
    
            // Optional: Show a success notification after loading
            Toastify({
                text: "Process Completed ‚úÖ",
                duration: 3000,
                gravity: "top",
                position: "center",
                backgroundColor: "#4CAF50",
                stopOnFocus: true
            }).showToast();
        }

        // Example Simulated Loading Process
        async function simulatedProcess() {
            startLoading(); // Show loading notification
            await new Promise(resolve => setTimeout(resolve, 3000)); // Simulate 3-second task
            stopLoading(); // Hide loading notification
        }
       </script>
        <script type="module">
        //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
        //Animation WebGL part   
			          import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.114.0/build/three.module.js';
                import { OrbitControls } from '../static/jsm/controls/OrbitControls.js';
                //import { CSS2DRenderer, CSS2DObject } from '../static/jsm/renderers/CSS2DRenderer.js'; 
                import { GUI } from '../static/jsm/libs/lil-gui.module.min.js';
                import { GLTFLoader } from '../static/jsm/loaders/GLTFLoader.js'; //Loading the GLTF file 
                import { RGBELoader } from '../static/jsm/loaders/RGBELoader.js'; //Loading the mesh rgb file 
                import { TransformControls } from '../static/jsm/controls/TransformControls.js';
                import { CSS2DRenderer, CSS2DObject } from '../static/jsm/renderers/CSS2DRenderer.js'; 

			         	var message_container = {}; 
                var main_text_message = {};
                var toal_activationres_list = [];
                var current_category_memory = {}; //Getting the category of the command activationres 
                var long_term_memory = {}; //
                var classify_list = {}; // Get classification sub element data detected for the prompts activationres  
                var trans_response = {} // get the translator data response 
                var data_semantic = {}; 
                var modelData= {};
                const poskeymod = {};
                var gui = new GUI();
                let cameraPersp, cameraOrtho, currentCamera;
                let scene,camera, renderer,labelRenderer, control, orbit, light, aspect, texture, geometry, material, mesh,grid;
                const gridExtensionFactor = 1.5; // Extend grid by 50% beyond the farthest model

                const controls = [];
                const models = [];
                const raycaster = new THREE.Raycaster();
                const mouse = new THREE.Vector2();
                const labels = [];
                var click_status = {}; // getting the click status data from the click response 
                let status_selected = {} //Get the part selected status to load the model by event 

		            init();   // Calling init function containing the model and mesh geometry loader 
		    	      render(); // rendering function  
        var email = document.getElementById("email_account").value; //Get the  
        var projectname = document.getElementById("projname").value; 
        console.log("Email account",email); 
        function processing_data_selected_components(email){
          fetch('/current_projs', {
                                                  // Declare what type of data we're sending
                                                  headers: {
                                                  'Content-Type': 'application/json'
                                                 },
                                                 // Specify the method
                                                method: 'POST',
                                               // A JSON payload
                                               body: JSON.stringify({
   
                                                           "email": email
                                              })
                                              }).then(function (response) { // At this point, Flask has printed our JSON
                                              return response.text();
                                              }).then(function (text) {
                                             console.log('POST response: ');
                                             var data_projectadd = JSON.parse(text);
                                              console.log("Get current project data",data_projectadd);  
                                              try{
                                                fetch('/deep_semantic_part_selection', {

                                                    // Declare what type of data we're sending
                                                  headers: {
                                                    'Content-Type': 'application/json'
                                                },
                                                // Specify the method
                                              method: 'POST',
                                              // A JSON payload 
                                              body: JSON.stringify({
                                                "email": email
                                             })
                                            }).then(function (response) { // At this point, Flask has printed our JSON
                                            return response.text();
                                            }).then(function (text) {
                                            console.log('POST response: ');
                                            // Should be 'OK' if everything was successful
                                            var part_selected = JSON.parse(text);
                                            console.log("Selected part",part_selected); //Display selected part 
                                            //Running the part selcted view add into the dynamic slider modal 
                                            var dict_components = part_selected[email][data_projectadd['project_name']];
                                            console.log("Component selected by AI",dict_components,Object.keys(dict_components));
                                            var datr =0; 
                                            var urls = []; 
                                            var list_compst = Object.keys(dict_components); //Get the list of the components data 
                                            console.log("Get list component: ",list_compst); //Get list of the components data 
                                            for(datr>=0;datr<=list_compst.length-1;datr++){
                                                       console.log("Category and selected file: ",list_compst[datr],dict_components[list_compst[datr]]);
                                                       //Passing the json data to encode the link arguement of the category and component
                                                       var categorycheck_list = ["Audio_system","Battery","Communication_system","Microcontroller","Motion_system","Navigation_system","Odometry_system","Sensor_array_to_image_system","Sensors","Single_Board_computer","Vision_system"]
                                                       if(categorycheck_list.includes(list_compst[datr]) == true){
                                                            var selected_file_comp = Object.keys(dict_components[list_compst[datr]])[0];
                                                            var url_encode_payload = {"email":email,"project_name":data_projectadd['project_name'],"category":list_compst[datr],"component":selected_file_comp}
                                                            var encode_urls = btoa(JSON.stringify(url_encode_payload)); 
                                                            console.log("Argument_url: ",list_compst[datr],encode_urls,typeof(encode_urls));    
                                                            var urls_encoder =  "https://roboreactor.com/components_loader_selected/"+String(encode_urls);                                                             
                                                            urls.push(urls_encoder); 
                                                             
                                                          }
                                            } 
                                            closeModalcom();
                                            console.log("List urls: ",urls); 
                                            components_selected_mmai(urls);
                                                

                                             }); 
                                            }
                                            catch{
                                                  console.log("Internal deep selected part error unable to fetch data ")
                                              }
                                           /*
                                            try{
                                               fetch('/reconstruct_selected_categorization',{
                                                              headers: {
                                                           'Content-Type': 'application/json'
                                                   },
                                                // Specify the method
                                                method: 'POST',
                                                // A JSON payload
                                               body: JSON.stringify({

                                                      "email": email,"project_name":data_projectadd['project_name']
                                               })
                                             }).then(function (response) { // At this point, Flask has printed our JSON
                                             return response.text();
                                             }).then(function (text) {
                                                console.log('POST response: ');
                                                // Should be 'OK' if everything was successful 
                                                    var compselect = JSON.parse(text); 
                                                    console.log("Automate selected data: ",compselect);
                                                    var datr =0; 
                                                    var urls = [];
                                                    for(datr >0;datr <=compselect.length;datr++){
                                                                
                                                                if(compselect[datr] != undefined){
                                                                  console.log("Category encoding: ",compselect[datr]); 
                                                                     //Check if the components is in the range of the directory components category 
                                                                     var categorycheck_list = ["Audio_system","Battery","Communication_system","Microcontroller","Motion_system","Navigation_system","Odometry_system","Sensor_array_to_image_system","Sensors","Single_Board_computer","Vision_system"]
                                                                     if(categorycheck_list.includes(compselect[datr]) == true){
                                                                            var url_encode_payload = {"email":email,"project_name":data_projectadd['project_name'],"category":compselect[datr]}
                                                                            var encode_urls = btoa(JSON.stringify(url_encode_payload)); 
                                                                            console.log(compselect[datr],encode_urls,typeof(encode_urls));     
                                                                            var urls_encoder =  "https://roboreactor.com/components_loader_selected/"+String(encode_urls);                                                             
                                                                            urls.push(urls_encoder); 
                                                                     }
                                                                }
                                                         
                                                    }
                                                    closeModalcom();
                                                    console.log("List urls: ",urls); 
                                                    components_selected_mmai(urls);
                                                    //Fetch back the data from ponents for the link url selected in the project 
                                                    
                                                  
                                                   }); 
                                              }
                                              catch{
                                                console.log("Internal semantic categorizer server error");
                                                notify_data('warning',"Components categorization server error");
                                              }
                                               */
                                         });                
        }           
				var myObject = {
	               "myBoolean": false,
                 "controlmodel":false,
                 "mic_control":false,
                 "savedata": false, 
                 "components_modal_close": function(){
                     console.log("Processing the componetns modal close");
                     //closeModal(); //Close the modal components       
                     //Use open instead for open current components model 
                     processing_data_selected_components(email);     
                      
                 },
                 "progress_modal_task":function(){
                        console.log("Processing multi-agent task display");
                        openModal(); 
                 },
	               "myFunction": function() {
	             	 console.log("Send command to back-end",main_text_message); 
				           	//Send the command into the back-end fetch the data 
		           		  document.getElementById('id01').style.display='block';
          /*
          try{
                          
				            fetch('/send_message', {
                                   // Declare what type of data we're sending
                                   headers: {
                                       'Content-Type': 'application/json'
                             },
                             // Specify the method
                             method: 'POST',
                              // A JSON payload
                             body: JSON.stringify({
	                                         "email":email,"payload_message":main_text_message  //Get the payload message data to send the data into the AI langchain 
                            })
                           }).then(function (response) { // At this point, Flask has printed our JSON
                           return response.text();
                           }).then(function (text) {
                           console.log('POST response: ');
                          // Should be 'OK' if everything was successful
                          var data_text = JSON.parse(text); 
					                console.log(data_text); // 
                         });
			          }
		         	catch{
				             console.log("Error communicate with back-end data")
		        	}
              */
	            },
              "Mute":function (){
                      console.log("Speech recognition deactivated!");      
                      stopSpeechRecognition()
              },
                "Assistant":function (){
                            console.log("Speech recognition activated!");
                            
                            startSpeechRecognition()
                            /*
                            setTimeout(() => {
                            recognition.abort();
                            recognition.lang = message_container['lang_dat'];
                            recognition.start();
                             }, 1000);  //We call recognition.start() in a timeout to make sure the abort() function is done      
                               */
              }, 
	            "myString": '',
	            "myNumber": "Non-select"
                 
               };
			   //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
			
       //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
                                                           //Controller function 
          //var isRecording = false
          window.SpeechRecognition =
          window.SpeechRecognition || window.webkitSpeechRecognition;
          const recognition = new SpeechRecognition(); // Getting Speech Recognition api

          //recognition.continuous = true;
          
          recognition.interimResults = true; // Browser corrects user's spelling mistakes and finalizes them.
          var isRecognitionActive = false;
          var list_lang = {"Non-select":"en-US","English-US":"en-US","French":"fr-FR","German":"de-DE","Spanish":"es-ES","Italian":"it-IT","Thai":"th-TH","Japanese": "ja-JP","Arabic": "ar-EG","Turkish": "tr-TR","Spanish": "es-MX","Russian": "ru-RU", "English-GB": "en-GB","Welsh": "cy-GB","Scottish Gaelic": "gd-GB","English": "en-ZA","Zulu": "zu-ZA","Afrikaans": "af-ZA","Portuguese": "pt-BR","Chinese-CN": "zh-CN","Chinese-HK": "zh-HK", "Hindi": "hi-IN","Bengali": "bn-IN","Telugu": "te-IN","Marathi": "mr-IN","Tamil": "ta-IN","English-CA": "en-CA","French": "fr-CA","Danish": "da-DK","Pashto": "ps","Dari": "fa-AF","Uzbek": "uz-AF","Turkmen": "tk","Albanian": "sq-AL","Arabic": "ar-DZ","Berber": "ber-DZ","German": "de-AT",}
          var matched_lang = {"en-US": "en", "fr-CA": "fr", "de-AT": "de", "es-MX": "es", "it-IT": "it", "th-TH": "th","zh-CN":"zh-cn", "ja-JP": "ja", "ar-DZ": "ar", "tr-TR": "tr", "ru-RU": "ru", "en-GB": "en", "cy-GB": "cy", "gd-GB": "gd", "en-ZA": "en", "zu-ZA": "zu", "af-ZA": "af", "pt-BR": "pt", "hi-IN": "hi", "bn-IN": "bn", "te-IN": "te", "mr-IN": "mr", "ta-IN": "ta", "en-CA": "en", "da-DK": "da", "ps": "ps", "fa-AF": "fa", "uz-AF": "uz", "sq-AL": "sq"}
          var get_list_box = gui.add(myObject,'myNumber',list_lang ).name("Language_settings");
          var msgerForm = get(".msger-inputarea"); 
          var msgerInput = get(".msger-input");
          var msgerChat = get(".msger-chat");
          var BOT_IMG = "../static/images_ai/Roboreactor_modern_2_logo.png";
          var PERSON_IMG = "../static/profile_uploads/"+email+"/avatar.png";
          var BOT_NAME = "Manufacturing Assistant";
          var PERSON_NAME = email.split("@")[0];
          var lastSentMessage = '';
          var language_setdat = {}
          var transform_logic = {};
          var lastSentMessage = '';
          var audio = null; // Global audio object
          var isPaused = false; // Tracks whether audio is paused

          get_list_box.setValue("Non-selected")
          get_list_box.domElement.classList.add('my-custom-select-box'); 
          get_list_box.onChange(function(value_set){
          console.log("List combodata",value_set);  
          document.getElementById("languageset").value = value_set; //Get language setting
          language_setdat['setlang'] = value_set;
				  message_container['lang_dat'] = value_set;
                  /*
                  recognition.abort();
                   setTimeout(() => {
                    recognition.abort();
                   recognition.lang = value_set;
                   recognition.start();
                   }, 1000);  //We call recognition.start() in a timeout to make sure the abort() function is done    
                  */
                   recognition.lang = language_setdat['setlang']; 
                  
                   recognition.onresult = (event) => {
                    var interimTranscript = '';
                    var finalTranscript = '';
                   for (let i = event.resultIndex; i < event.results.length; i++) {
                          const trans_speak = event.results[i][0].transcript;
                          if (event.results[i].isFinal) {
                                finalTranscript += trans_speak + ' ';
                          } else {
                               interimTranscript += trans_speak;
                          }
                            // Update the input field with the interim transcript
                 msgerInput.value = interimTranscript;
                // If we have a final transcript, use it
               if (finalTranscript !== '') {
                   
                    msgerInput.value = finalTranscript.trim();
                    console.log("Final transcript:", finalTranscript);
                    // Add line breaks if necessary
                  addLineBreaksIfNeeded();
                  // Only send the message if it's different from the last sent message
                  if (finalTranscript.trim() !== lastSentMessage) {
                       var audioduration = document.getElementById('audioduration').value; 
                       var current_duration = document.getElementById('current_audio').value;
                       console.log("Processing current audio status: ",audioduration,current_duration);
                       sendMessage();

                       lastSentMessage = finalTranscript.trim();
                         //Adding Addvance semantic search integration on the top here 
                      
                          
                          //translate_lang(event.results[i][0].transcript,"en");
                          fetch('/translator_module',{
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({
                                   "email": email,"command":trans_speak,"dest_trans": matched_lang[value_set]    //value_set   // Get the destiny language data to translate back the server reference   
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                                  var trans_dat = JSON.parse(text); 
                                  console.log("Trans_data",trans_dat[email]); //Get the current user data  

                          console.log("Translate_main_data",trans_dat[email]['en']); 
                          var projectname = document.getElementById("projname").value;
                          
                          const transcript = trans_dat[email]['en']    // Translate everything into eng 
                          //const transcript = trans_response["transdat"][email]['en'];  
                          if (event.results[i].isFinal) { 
                             console.log(transcript);
                            
                             var data_splitter = word_ninja(transcript); // Get the word splitter to compare the data 
                             
                             //Fetch the language translation at the back-end processing 
                             var selected_command_list = {}; 
                             //Fetch the data send into the back-end to processing the data of the part selection 
                             // POST
                             notify_data("success","Listening ...")
                             stopLoading();
                             fetch('/speech_prompts', {
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({
                                   "email": email,"command":transcript
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          // Should be 'OK' if everything was successful
                                 //notify_data("success","Processing please wait...")
                                 startLoading();
                                 var data_json = JSON.parse(text);
                                 
                                 console.log("Answer AI",data_json['command_ref']); 
                                 semantic_check(email,data_semantic,trans_dat[email]['en'],projectname,data_splitter,data_json,value_set);
                                 stopLoading();
                                                                   
                          });
                            
                         }
                      });

                 }  //Translator end here on the top
                
                    
            }
          }
        }
               
          }) 
          function startSpeechRecognition() {
                       if (!isRecognitionActive) {
                             recognition.start();
                             isRecognitionActive = true;
                             console.log("Speech recognition started");
                             // You can add UI changes here, e.g., changing a button's text or color
                       }
                   }

                  function stopSpeechRecognition() {
                      if (isRecognitionActive) {
                             recognition.stop(); 
                             isRecognitionActive = false;
                             console.log("Speech recognition stopped");
                            // You can add UI changes here, e.g., changing a button's text or color
                       }
                   }

          recognition.addEventListener("end", () => {
          if (isRecognitionActive) {
              recognition.start();
             }
          });
          /*
          recognition.addEventListener("end", () => {

               recognition.start();
          
        });
          // Starting the recognition.
          recognition.start();
        */
      /*
      var text_input = gui.add( myObject, 'myString' ).name("Message");   // Text Field
      text_input.onChange(function(value_text){       
	               console.log("Text_output ",value_text); // get the output data 
                 main_text_message['Message'] = value_text; 
                 console.log(main_text_message);
      })
      */		
      var cet = gui.addFolder("Transform control");
       cet.add(myObject, 'controlmodel').name('Transform menu').onChange((value) => {
      // This function runs whenever the checkbox value changes
      console.log('Control menu:', value);
      transform_logic['status'] = value; //Get the transform logic data input 

    });
    cet.close(); //close the folder before activate 
    
    var cvt = gui.addFolder("Project and AI assistant");               
    cvt.add(myObject,'savedata').name('Auto save project').onChange(function(logic_save){
            console.log('Auto save status',logic_save);
            if(logic_save == true){
                    console.log('Auto save data:',logic_save); 
                    //Fetching data to back-end to save the current data state          
            }
            if(logic_save == false){
                    console.log('Auto save data: ',logic_save);
                    //Fetching  data to back-end to stop the current data state 
            }
    });
		cvt.add( myObject, 'myFunction' ).name("Project manager"); // Button send the message back to AI at the back-end data
    
    cvt.add(myObject,'components_modal_close').name("Auto selected components");
    cvt.add(myObject,'progress_modal_task').name("Multi-agent task monitor");
    /*
    cvt.add(myObject,'mic_control').name('Microphone').onChange((value) =>{
          if(value == true){
            console.log("Start the microphone "); 
            startSpeechRecognition();
          }
          if(value == false){
            console.log("Stop the microphone ");
            stopSpeechRecognition();
          }
    })
    */
    var start_assist = cvt.add(myObject, 'Assistant').name("Talk with AI Assistant"); // Button to talk with AI assistant via speech recognition using the Falcon LLM 
    var mute_assistant =cvt.add(myObject,'Mute').name("Close microphone");  
      
      cvt.close();             
          //Trigger when needed in the loop of the command 
          /*
          function startRecording() {
             if (isRecording == false) {
                     isRecording = true
                      // document.getElementById("start-recording").style.backgroundColor = 'Red';
             }else{
             isRecording = false
                     //.getElementById("start-recording").style.backgroundColor = 'Grey';
              }
              console.log(isRecording)
          }
          */
        //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
        function init() {
            // Renderer setup
            renderer = new THREE.WebGLRenderer();
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            //label 
            labelRenderer = new CSS2DRenderer();
            labelRenderer.setSize(window.innerWidth, window.innerHeight);
            labelRenderer.domElement.style.position = 'absolute';
            labelRenderer.domElement.style.top = '0';
            labelRenderer.domElement.style.pointerEvents = 'none';
            document.body.appendChild(labelRenderer.domElement);   
            // Camera setup
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.01, 1000);
            camera.position.set(5, 5, 10);
            camera.lookAt(0, 0, 0);
            
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color( 0x333333 );
		        scene.environment = new RGBELoader().load( '../static/textures/equirectangular/venice_sunset_1k.hdr' );
		        scene.environment.mapping = THREE.EquirectangularReflectionMapping;
            grid = new THREE.GridHelper( 20, 40, 0xffffff, 0xffffff );
			      grid.material.opacity = 0.2;
		      	grid.material.depthWrite = false;
		      	grid.material.transparent = true;
            scene.add(grid); 
            //scene.add(new THREE.GridHelper(10, 10, 0x888888, 0x444444));

            // Lighting
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(1, 1, 1);
            scene.add(light);

            // Controls setup
            orbit = new OrbitControls(camera, renderer.domElement);
            orbit.update();
            orbit.addEventListener('change', render);

            // Mouse click event for raycasting
            window.addEventListener('click', onMouseClick, false);
				
			}
      //const modelData = {}; // Dictionary to store model name and position
    //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    //Get the current status memory input of the scene to know witch function has been working on 
    function fetching_latest_position(email,project_name,descp_status){
            console.log("Fetcching the current position");
                        
    }
    /*
    var email = document.getElementById("email_account").value; 
    fetch('/current_projs', {
                                                  // Declare what type of data we're sending
         headers: {
        'Content-Type': 'application/json'
      },
                                                 // Specify the method
       method: 'POST',
                                               // A JSON payload
        body: JSON.stringify({
   
                  "email": email
       })
       }).then(function (response) { // At this point, Flask has printed our JSON
            return response.text();
       }).then(function (text) {
         console.log('POST response: ');
         var data_projectadd = JSON.parse(text);
         console.log("Get current project data",data_projectadd);      
         //Load multimodal based number of each compomponent with label successfully 
         get_selected_part(email,data_projectadd['project_name'],"selected_com_num");
      });
      */
    var file_current = {};
    var state_rightclick = {}; //Get status of right click 
    function visualize_selected_components(email){
      fetch('/current_projs', {
                                                  // Declare what type of data we're sending
         headers: {
        'Content-Type': 'application/json'
      },
                                                 // Specify the method
       method: 'POST',
                                               // A JSON payload
        body: JSON.stringify({
   
                  "email": email
       })
       }).then(function (response) { // At this point, Flask has printed our JSON
            return response.text();
       }).then(function (text) {
         console.log('POST response: ');
         var data_projectadd = JSON.parse(text);
         console.log("Get current project data",data_projectadd);      
         //Load multimodal based number of each compomponent with label successfully 
         get_selected_part(email,data_projectadd['project_name'],"selected_com_num");
      });
    } 
    function updateGridHelper() {
    // Remove existing grid
    if (grid) {
        scene.remove(grid);
    }

    // Find the maximum absolute coordinate among all models
    let maxCoord = 0;
    models.forEach(model => {
        maxCoord = Math.max(maxCoord, 
            Math.abs(model.position.x), 
            Math.abs(model.position.y), 
            Math.abs(model.position.z)
        );
    });

    // Calculate new grid size
    const gridSize = Math.ceil(maxCoord * gridExtensionFactor);
    const gridDivisions = 20; // You can adjust this for more or fewer grid lines

    // Create new grid
    grid = new THREE.GridHelper(gridSize * 2, gridDivisions, 0xffffff, 0x888888);
    grid.material.opacity = 0.2;
    grid.material.transparent = true;
    scene.add(grid);

    // Update renderer and camera
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();

    // Optionally, adjust camera position or controls target if needed
    // orbit.target.set(0, 0, 0);
    // camera.position.set(gridSize, gridSize, gridSize);
    // orbit.update();

    render();
}

// Modify your animate function to include grid update
function animate(multi_agent_task_progress) {
    requestAnimationFrame(animate);
    TWEEN.update();
   // setInterval(multi_agent_task_progress, 3);
    updateGridHelper(); // Add this line
    render();
}
    function get_selected_part(email,project_name,task_descp){
       if(task_descp == "selected_ai"){ 
          fetch('/Get_selected_components', {
            // Declare what type of data we're sending
            headers: {
           'Content-Type': 'application/json'
           },
           // Specify the method
           method: 'POST',
           // A JSON payload
           body: JSON.stringify({'email':email,"project_name":project_name})
           }).then(function (response) { // At this point, Flask has printed our JSON
           return response.text();
          }).then(function (text) {
          console.log('POST response: ');
          // Should be 'OK' if everything was successful
          var getpart =  JSON.parse(text); //Get the posted current position and store in json data 
          console.log("Selected part: ",getpart); //Get the current position data 
          load_multiple_selected_model(getpart,email,project_name,task_descp);
          });
        }
        if(task_descp == "selected_com_num")
           fetch('/get_quantity_com', {
            // Declare what type of data we're sending
            headers: {
           'Content-Type': 'application/json'
           },
           // Specify the method
           method: 'POST',
           // A JSON payload
           body: JSON.stringify({'email':email,"project_name":project_name})
           }).then(function (response) { // At this point, Flask has printed our JSON
           return response.text();
          }).then(function (text) {
          console.log('POST response: ');
          // Should be 'OK' if everything was successful
          var getpart_q =  JSON.parse(text); //Get the posted current position and store in json data 
          console.log("Getting data: ",getpart_q); 
          load_multiple_selected_model(getpart_q,email,project_name,task_descp) 
          //Get the selected part with the quantity requirement of each model 

                
         });
    }
    function load_multiple_selected_model(model_multiply,email,project_name,selected_status){
       if(selected_status == "selected_ai"){
         console.log("Selected component by AI llms");
         for(let ty=0;ty<=Object.keys(model_multiply).length-1;ty++){
            console.log("category_load",Object.keys(model_multiply)[ty]);
            var category = Object.keys(model_multiply)[ty] 
            var model_file = Object.keys(model_multiply[category])[0];
            console.log("File name: ",model_file); //Get file name of component 
            model_loader_function([model_file],email,project_name,category,ty*0.3,ty*0.3,0); 
         }
       }
       if(selected_status == "selected_com_num"){
           console.log("Selected components with quantity requirement");
          // startLoading(); //Start loading the data
           for(let ty=0;ty<=Object.keys(model_multiply).length-1;ty++){

               console.log("category_load",Object.keys(model_multiply)[ty]);
               var category = Object.keys(model_multiply)[ty] 
               var model_file = Object.keys(model_multiply[category]); 
               for(let num_model=0;num_model<=model_file.length-1;num_model++){

                  const modelfiles = model_file[num_model]
                  console.log("Multi_model_category: ",modelfiles); 
                  var quantity_com = model_multiply[category][modelfiles]
                  var Quantity = parseInt(model_multiply[category][modelfiles]['Quantity'],10);
                  console.log("File name: ",model_file); //Get the file name of the component
                  console.log("Quantity and com: ",quantity_com['Quantity']) //Get the quantity and communication  
                  console.log("Quantity: ",Quantity); 
                  for(let nm = 0; nm<=Quantity-1;nm++){
                     console.log("Load multiple model: ",nm); //Load multiple model data           
                     model_loader_function([modelfiles],email,project_name,category,ty*0.3,ty*0.3,nm*0.3+num_model*0.2); 
                  }
               }
           }
           stopLoading(); //Finish loadingdata 
        }

    }
    function clearScene(scene) {
    // Remove all objects from the scene
    while(scene.children.length > 0) { 
        const object = scene.children[0];
        
        // Dispose of geometries and materials
        if (object.geometry) object.geometry.dispose();
        if (object.material) {
            if (Array.isArray(object.material)) {
                object.material.forEach(material => material.dispose());
            } else {
                object.material.dispose();
            }
        }
        
        // Remove CSS2D labels
        if (object.isCSS2DObject) {
            // Remove the HTML element from the DOM
            if (object.element && object.element.parentNode) {
                object.element.parentNode.removeChild(object.element);
            }
        }
        
        // Recursively clear children
        if (object.children && object.children.length > 0) {
            clearScene(object);
        }
        
        // Remove the object from the scene
        scene.remove(object);
    }

    // Dispose of any textures in the scene
    for (const texture of Object.values(THREE.Cache.files)) {
        texture.dispose();
    }

    // Clear the texture cache
    THREE.Cache.clear();

    // Clear any global arrays or objects storing references to scene objects
    if (window.cubes) window.cubes = [];
    if (window.modelLabels) window.modelLabels = [];
    if (window.lineLabels) window.lineLabels = [];
    if (window.axesGroups) window.axesGroups = [];
    if (window.lines) window.lines = [];

    // Clear any label update functions
    if (window.labelUpdateFunctions) window.labelUpdateFunctions = [];
}
    //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    function model_loader_function(modelPaths,email,project_name,category,nr,ny,nz) {
      const loader = new GLTFLoader();
    var store_label_pos = []; 
    var current_model = {};
    var error_status = {}; 
    modelPaths.forEach((path, index) => {
        var path_file = "../static/Client_projects/" + email.split(".com")[0] + "/" + project_name + "/" + category + "/" + modelPaths;
        loader.load(path_file, function (gltf) {
            let model = gltf.scene;
            
            model.position.set(index * nr, ny, nz); // Initial position
            scene.add(model);
            models.push(model);

            // Extract file name
            const filename = path.split('/').pop().split(".")[0] + "_" + JSON.stringify({ x: model.position.x, y: model.position.y, z: model.position.z });
            current_model[filename] = "selected";
            console.log("Current model file: ", filename);
            model.name = filename;

            // Create label
            var labelDiv = document.createElement('div');
            var namecut_length = filename.split("_")[filename.split("_").length-1];
            var construct_namecut = filename.split(namecut_length)[0];
            labelDiv.className = 'label';
            labelDiv.textContent = construct_namecut;
            var label = new CSS2DObject(labelDiv);

            // Function to update label position
            function updateLabelPosition() {
                const box = new THREE.Box3().setFromObject(model);
                const center = new THREE.Vector3();
                box.getCenter(center);
                
                // Calculate the offset from the model's position to its center
                const offset = center.sub(model.position);
                
                // Set the label position to the center of the model
                label.position.copy(offset);
            }

            // Fetch stored position data
            fetch('/get_store_pos', {
                headers: {
                    'Content-Type': 'application/json'
                },
                method: 'POST',
                body: JSON.stringify({'email': email, "project_name": project_name})
            })
            .then(response => response.json())
            .then(data => {
                console.log("Fetched position data: ", data);
                var checkkeys = Object.keys(data)[0]; 

                if(checkkeys == 'error'){
                     if(Object.keys(error_status).includes('error') != true){
                        error_status['error']  = 'current_pos_error';   
                        console.log('Error requesting current position data');
                        notify_data('error',"Error requesting current position data");
                     }
                }
                if(checkkeys != 'error'){
                   error_status = {};
                   console.log('Clearing error status');
                }
                if (data[filename]) {
                    // Update model position and rotation
                    model.position.set(
                        data[filename].position.x,
                        data[filename].position.y,
                        data[filename].position.z
                    );
                    model.rotation.set(
                        THREE.MathUtils.degToRad(data[filename].rotation.x),
                        THREE.MathUtils.degToRad(data[filename].rotation.y),
                        THREE.MathUtils.degToRad(data[filename].rotation.z)
                    );
                    console.log(`Updated ${filename} position:`, model.position);
                    console.log(`Updated ${filename} rotation:`, model.rotation);
                }

                // Update label position
                updateLabelPosition();

                // Store initial position and rotation in the dictionary
                modelData[filename] = { 
                    position: { x: model.position.x, y: model.position.y, z: model.position.z },
                    rotation: { 
                        x: THREE.MathUtils.radToDeg(model.rotation.x), 
                        y: THREE.MathUtils.radToDeg(model.rotation.y), 
                        z: THREE.MathUtils.radToDeg(model.rotation.z) 
                    }
                };

                // Add label to the model
                labels.push(label); 
                model.add(label);

                // Add TransformControls for each model
                let control = new TransformControls(camera, renderer.domElement);
                control.attach(model);
                control.addEventListener('change', () => {
                    if (control.object) {
                        const { x: posX, y: posY, z: posZ } = control.object.position;
                        const { x: rotX, y: rotY, z: rotZ } = control.object.rotation;

                        modelData[filename] = { 
                            position: { x: posX, y: posY, z: posZ },
                            rotation: { 
                                x: THREE.MathUtils.radToDeg(rotX), 
                                y: THREE.MathUtils.radToDeg(rotY), 
                                z: THREE.MathUtils.radToDeg(rotZ) 
                            }
                        };
                        poskeymod[JSON.stringify({ 
                            position: { x: model.position.x, y: model.position.y, z: model.position.z },
                            rotation: { 
                                x: THREE.MathUtils.radToDeg(model.rotation.x), 
                                y: THREE.MathUtils.radToDeg(model.rotation.y), 
                                z: THREE.MathUtils.radToDeg(model.rotation.z) 
                            }
                        })] = filename;
                        file_current['name'] = filename;
                        console.log(`Updated for ${filename}: Position x=${posX}, y=${posY}, z=${posZ}, Rotation x=${modelData[filename].rotation.x}, y=${modelData[filename].rotation.y}, z=${modelData[filename].rotation.z}`);
                        fetch_model_pos("store_current_position", "current position: ", {'email': email, "project_name": project_name, "current_pos": modelData});
                        updateGridHelper();
                        updateLabelPosition(); // Update label position when model is transformed
                    }
                });

                control.addEventListener('change', render);
                control.addEventListener('dragging-changed', (event) => {
                    orbit.enabled = !event.value;
                });

                scene.add(control);
                controls.push(control);

                render(); // Render the scene after updating positions

            })
            .catch(error => {
                console.error('Error fetching stored positions:', error);
            });
        });
    });

    // Event Listeners
    window.addEventListener('resize', onWindowResize);
    window.addEventListener('keydown', onKeyDown);
}
const contextMenu = document.getElementById("contextMenu");
const editDataItem = document.getElementById("editdata");
const movemodel =  document.getElementById("movemodelid");
const rotatemodel = document.getElementById("rotatemodelid");
const removecontrol = document.getElementById("detachcontrol"); // Get the deteach control from the model for clear sight 
const deleteIdItem = document.getElementById("deleteid");

        // Show the context menu at the mouse position
        document.addEventListener("contextmenu", (e) => {
            e.preventDefault();
            contextMenu.style.top = `${e.clientY}px`;
            contextMenu.style.left = `${e.clientX}px`;
            if(transform_logic['status']  == true){  
                contextMenu.style.display = "block";
            }
        });
        // Hide the context menu when clicking elsewhere
        document.addEventListener("click", () => {
            contextMenu.style.display = "none";
        });


//Handle "Move model " click 
movemodel.addEventListener("click", () => {
     console.log("Remove the model");
     controls.forEach(control => control.setMode('translate'));

});
rotatemodel.addEventListener("click", () =>{
    console.log("Rotate the model");
    controls.forEach(control => control.setMode('rotate'));

})
        // Handle "Edit component" click
editDataItem.addEventListener("click", () => {
    console.log("Remove control from the system");
    location.reload(true);   //reload page for edit data 
    contextMenu.style.display = "none";
});
//Handle "detach model" click 
removecontrol.addEventListener("click", () => {
    console.log("Remove control from the system");
    controls.forEach(control => control.detach());
    contextMenu.style.display = "none";
});
// Handle "Delete File" click
deleteIdItem.addEventListener("click", () => {
    //const modelName = contextMenu.dataset.modelName;
    var current_data = file_current['name'];
    removeModelByName(current_data); //Remove the file of the current model 
    console.log("Delete this data",current_data);
    contextMenu.style.display = "none";
});

function removeModelByName(name) {
    // Check if the model exists in the scene
    const modelIndex = models.findIndex(model => model.name === name);
    if (modelIndex !== -1) {
        const model = models[modelIndex];

        // Remove associated TransformControls
        const controlIndex = controls.findIndex(control => control.object === model);
        if (controlIndex !== -1) {
            const control = controls[controlIndex];
            scene.remove(control);
            controls.splice(controlIndex, 1);
        }

        // Remove the label associated with the model
        const labelIndex = labels.findIndex(label => label.parent === model);
        if (labelIndex !== -1) {
            const label = labels[labelIndex];
            model.remove(label); // Remove label from the model
            labels.splice(labelIndex, 1);
        }

        // Remove the model itself
        scene.remove(model);
        models.splice(modelIndex, 1);

        // Remove the model data from the dictionary
        delete modelData[name];

        console.log(`Model "${name}" and its label have been removed.`);
        render();
    } else {
        console.log(`Model "${name}" not found.`);
    }
}
function fetch_model_pos(end_point,display,payload){

    fetch('/'+end_point, {

                   // Declare what type of data we're sending
        headers: {
                'Content-Type': 'application/json'
    },
    // Specify the method
    method: 'POST',
    // A JSON payload
    body: JSON.stringify(payload)
    }).then(function (response) { // At this point, Flask has printed our JSON
    return response.text();
    }).then(function (text) {
    console.log('POST response: ');
     // Should be 'OK' if everything was successful
     var getpart =  JSON.parse(text); //Get the posted current position and store in json data 
     console.log(display,getpart); //Get the current position data 

   });
   
}


        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            labelRenderer.setSize(window.innerWidth, window.innerHeight);
            render();
        }

        function onKeyDown(event) {
             console.log("Key code input: ",event.keyCode);
             /*
            switch (event.keyCode) {
                case 87: // W
                    controls.forEach(control => control.setMode('translate'));
                    break;
                case 69: // E
                    controls.forEach(control => control.setMode('rotate'));
                    break;
          
            }
            */
        }

        function toggleControl(index) {
            controls.forEach((control, i) => {
                control.enabled = i === index; // Enable only the selected control
            });
        }

        function render() {
            renderer.render(scene, camera);
            labelRenderer.render(scene, camera);
        }
        //
        function onMouseClick(event) {
            // Normalize mouse coordinates to (-1 to 1) for both axes
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;

            // Update raycaster
            raycaster.setFromCamera(mouse, camera);
            console.log("Pickup model data:");
            click_status['clicked'] = true //Get the click logic status 

           
        
        }
 

			
function probabilistic_semantic_function(transcript,data_splitter,data_json,value_set){
               //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
                                                                    //Command detection                  
                                 var probabilistic_answer = {} //Find the probablity of the answer in the data of word input command 
                                 var probabilistic_questions = {} //Find the probabilistic activationres 
                                 var probabilistic_activationres = {} //Probabilistic for the activationres data function 

                                 var current_awareness = []; //Detecting the current awareness system 
                                 //notify_data("success",data_json['answer']['kornbot380@hotmail.com']['Answer'])
                                 //condition_notify("success",data_json['answer']['kornbot380@hotmail.com']['Answer'])
                                 // Find and display the intersection
                                 console.log("Word splitter",data_splitter)
                                
                                 //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
                                                                     //Word similarity function 

                                 var  intersection = findIntersection(data_splitter,data_json['command_ref']);
                                 console.log('Intersection:', intersection);
                                 // Find and display the similarity
                                 var  similarity = findSimilarity(data_splitter,data_json['command_ref']);
                                 console.log('Similarity:', similarity + '%');
                                 
                                 //Open new component feature 

                                 if(similarity >0){
                                      //Similarity detected 
                                      //speak("I'm working on it",value_set);
                                      //Classify the data topic header detector 
                                      var vil = 0; 
                                      for(vil>1; vil<Object.keys(data_json).length;vil++){
                                             console.log(intersection,Object.keys(data_json)[vil],data_json[Object.keys(data_json)[vil]]); 
                                            
                                            var  sub_intersect = findIntersection(intersection,data_json[Object.keys(data_json)[vil]]); 
                                            var  sub_similarity = findSimilarity(sub_intersect,data_json[Object.keys(data_json)[vil]]); 
                                            //Add the data into the list and find the maximum value for the data input 
                                            console.log(sub_similarity,Object.keys(data_json)[vil]); 
                                            probabilistic_answer[sub_similarity] = Object.keys(data_json)[vil]; //Get the probabilistic data to classify command 
                                      
                                      }    
                                      var select_prob = findMaxNumber(Object.keys(probabilistic_answer))
                                      if(select_prob > 25){
                                          if(probabilistic_answer[select_prob] != "command_ref"){

                                             console.log("Found selected",probabilistic_answer[select_prob]);

                                             //speak("Creating project directory",value_set);                                 
                                             translate_lang("Creating project directory",value_set);
                                             notify_data("success","Opening "+String(probabilistic_answer[select_prob]));

                                             var extract_projectname =  word_ninja(transcript); //Get the list of the project extraction to see if there is a name of the project 
                                             //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
                                                                                 //Attention activation on each of the category detection after probabilistic calculation 
                                             //Detecting each last parameter need to be input 
                                             var last_element_detect =  data_json["project detect"] //["new","project","name","call","called","is","so","the"]
                                             var project_statement = [] //Save the project statement data of the current project 
                                             var project_dec = []  //Check the current key word detect 
                                             var bw = 0; 
                                             console.log("Detecting the project name",extract_projectname[extract_projectname.length-1]);
                                             //Running the for loop backward to detect the project and break 
                                             //Running the list backward by detecting the data   
                                             console.log("Search for the current project existance") 
                                             var result_refsearch = {}; //Get the reference data of the search project list  
                                             for(bw=extract_projectname.length-1 ;bw >0; bw--){
                                                          console.log("Reverse input",extract_projectname[bw]);
                                                          if(last_element_detect.includes(extract_projectname[bw]) == false){ 
                                                                   if(data_json['command_ref'].includes(extract_projectname[bw]) == false){
                                                                           project_statement.push(extract_projectname[bw]); 
                                                                   }

                                                          }

                                             }                       
                                             console.log("Get the current project name",[...project_statement].reverse());
                                             
                                             var project_name_detected = [...project_statement].reverse().join(" "); 
                                             var list_proj_cal = word_ninja(project_name_detected); 
                                             console.log("Project calibration",list_proj_cal);
                                             //Get the project name from the response to send to the data 
                                             var calprojs = []; //Get the calibrate project name 
                                             var ref_word = ["would","like","want","wanting","to","know","a","creation","create","of","."];
                                             var cps = 0; 
                                             for(cps >0;cps <= list_proj_cal.length-1;cps++){
                                                   try{
                                                       console.log("Calibrate projectname",list_proj_cal[cps]);
                                                       if(ref_word.includes(list_proj_cal[cps]) != true){
                                                            
                                                                 calprojs.push(list_proj_cal[cps]); // Get the project 
                                                                 
                                                       }
                                                    }
                                                    catch{
                                                         console.log("Not found in the list undefine");
                                                    }

                                             }
                                             console.log("Re-calibrated project name ",calprojs.join("_").split(".")[0]); //Get the project name data 
                                             //console.log("Currrent project file existance ",result_refsearch); //get the current project existance  
                                             //console.log("output result current project ",result_refsearch); 
                                             var new_calb_proj = calprojs.join("_").split(".")[0]; // New calibrated project data 
                                             if(project_name_detected != ""){
                                                  if(Object.keys(data_json).includes(project_name_detected) == false){
                                                        if(data_json['command_ref'].includes(project_name_detected) == false){
                                                                  //speak("Your current project name is "+project_name_detected,value_set);
                                                                  translate_lang("Your current project name is "+new_calb_proj,value_set); //project_name_detected,value_set);
                                                                  notify_data("success","Your current project name is "+new_calb_proj);
                                                                  var result_refsearch = {} //Get the current project data extraction to check existance of the directory 
                                                                  search_existing_project(email,result_refsearch,new_calb_proj,value_set); //get the project search 
                                                                  //Load project name into the argument to load the model file into the system
                                                                  //Adding the functio to create the new directory 
                                                                  //Get the 3D components from the project description to select the part or asking for the part directly 


                                                        }
                                                        
                                                      
                                                                   
                                                       
                                                  }
                                                
                                            }
                                             
                                             if(project_name_detected == ""){
                                                        //Check similarity again     
                                                        if(Object.keys(data_json).includes(project_name_detected) == false){
                                                                   //speak("Please repeat your project name again This name is do not allow to name project",value_set);
                                                                   translate_lang("Please repeat your project name again This name is do not allow to name project",value_set); 
                                                                   notify_data("error","Please repeat your project name again.This name is do not allow to name project.");
                                                        }
                                                        if(Object.keys(data_json).includes(project_name_detected) == true){
                                                                        //Compare similarity if true 
                                                                    console.log("Finding the similarity of the function activation in the call mode")
                                                                    //speak("opening the "+project_name_detected,value_set)
                                                                    translate_lang("opening the "+project_name_detected,value_set);
                                                                    notify_data("success","Opening the "+project_name_detected);

                                                        }

                                                        

                                             }
                                             
                                             

                                          }


                                          if(probabilistic_answer[select_prob] == "command_ref"){
                                                //Check if the project found then reclassify the command in the message_container 
                                               //speak("You may need to create new project first by saying I need to create new project and follow by the name of your project you want to create.",value_set); 
                                               translate_lang("You may need to create new project first by saying I need to create new project and follow by the name of your project you want to create.",value_set);
                                               notify_data("warning","Please create new project by saying or typing I need new to create new project the fillow by your project name") 


                                          }

                                      }
                                     
                                      
                                }
                                //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
                                                                                     //activationres data detection 
                                             //This feature running the function separately to answer the question about the pdf data and other                                     
                                 //Use the speaker when create the likely possibility data to detecting the relationship between function 
                                 //Finding the new similarlity of the of the activationres command 
                                 //activationres re ordering data 
                                 fetch('/speech_questions_prompts', {
                                             // Declare what type of data we're sending
                                            headers: {
                                               'Content-Type': 'application/json'
                                            },
                                            // Specify the method
                                            method: 'POST',
                                            // A JSON payload
                                            body: JSON.stringify({
                                                   "email":email,"command":transcript
                                           })
                                           }).then(function (response) { // At this point, Flask has printed our JSON
                                           return response.text();
                                           }).then(function (text) {
                                           console.log('POST response: ');
                                           // Should be 'OK' if everything was successful 
                                           var questions_json = JSON.parse(text);

                                           console.log("Questions prompts datas",questions_json);
                                           var questions_dat = questions_json['Question']
                                           console.log(questions_dat); //Get the activationres data list  
                                           var  q_intersect = findIntersection(data_splitter,questions_json['Question']);
                                           console.log('Questions_Intersection:', q_intersect);
                                          // Find and display the similarity
                                          var  q_similarity = findSimilarity(data_splitter,questions_json['Question']);
                                          console.log('Questions_Similarity:', q_similarity + '%');
                                          if(q_similarity > 0){

                                                      //Processing the data of the sub similarity comparation of the data category activationres selection 
                                                      console.log("Container sub data text processing Questions",data_splitter); 
                                                      //Finding the sub intersection to get the right selected highest possibility activationres detected 
                                                      var vil = 0; 
                                                      for(vil>1; vil<Object.keys(questions_json).length;vil++){

                                                                     console.log("Questions data",Object.keys(questions_json)[vil],questions_json[Object.keys(questions_json)[vil]]); 
                                                                     var  q_sub_intersect = findIntersection(q_intersect,questions_json[Object.keys(questions_json)[vil]]); 
                                                                     var  q_sub_similarity = findSimilarity(q_intersect,questions_json[Object.keys(questions_json)[vil]]); 
                                                                     //Add the data into the list and find the maximum value for the data input 
                                                                     console.log(q_similarity,Object.keys(questions_json)[vil]); 
                                                                     probabilistic_questions[q_sub_similarity] = Object.keys(questions_json)[vil]; //Get the probabilistic data to classify command 


                                                      }
                                                      var q_select_prob = findMaxNumber(Object.keys(probabilistic_questions))
                                                      console.log("Selected question from the list",q_select_prob,probabilistic_questions[q_select_prob])
                                                      if(q_select_prob > 4){


                                                                     if(probabilistic_questions[q_select_prob] != "Question" && probabilistic_activationres[q_select_prob] != "command_ref"){

                                                                                     console.log("Found selected",probabilistic_questions[q_select_prob]); 
                                                                                     //speak("Accessing large language model"+String(probabilistic_activationres[activation_select_prob]),value_set); 
                                                                                     notify_data("success","Accessing large language model")
                                                                                     //LLM_model_activate(transcript,value_set); //Next time making it settable language models
                                                                                     //Load free asyncronous large language model here 
                                                                                     //Free_LLM_model_activate(transcript,value_set);
                                                                                     //Load llama2 or orca2 service
                                                                                     llama2_model_activate(transcript,value_set);  
                                                                                      
                          
                                                                     }
                                                                   

                                                      }



                                          }
                                           
                                            
                                             
                                });
                                //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
                                                                //Application detection and command
                                //activation_speech("")

                                //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
                                                                //Selection detection 
                                //Detecting the components classification 
                                activation_speech("speech_components_classification",data_splitter,"component classification","component classify",probabilistic_activationres,email,transcript,value_set,"components_classification","motion part"); //components_classification("OK",value_set)); //Input the parameters needed for the classification data 
                                //Detecting the part analysis 
                                //activation_speech("speech_free_llms_concurrency",data_splitter,"component classification","component classify",probabilistic_activationres,email,transcript,value_set,"components_classification","motion part")
                                //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
                                                                  //Appointment and time table data 
                                                                  
                                //activation_speech("Application_features_interface",data_splitter,"application","application",probabilistic_activationres,"kornbot380@hotmail.com",transcript,value_set,"Application_features_interface","applications");
                                test_activation_speech_match("Application_features_interface",data_splitter,"application","application",probabilistic_activationres,email,transcript,value_set,"Application_features_interface","applications");
                                //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
                                                                 //Searching data                                   



                                //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
                                //Clear the possibility list of the selection or json data in the container for short memory container 
                                clear_probabilistic_data(probabilistic_answer);
                                clear_probabilistic_data(probabilistic_questions);
                                clear_probabilistic_data(probabilistic_activationres); 
                                //probabilistic_answer.clear();
                                //probabilistic_activationres.clear(); 
    
}
//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
function addLineBreaksIfNeeded() {
  const maxWidth = msgerInput.offsetWidth - 20; // Subtracting some padding
  const canvas = document.createElement('canvas');
  const context = canvas.getContext('2d');
  context.font = window.getComputedStyle(msgerInput).font;

  let lines = msgerInput.value.split('\n');
  let newLines = [];

  for (let line of lines) {
    let words = line.split(' ');
    let currentLine = '';

    for (let word of words) {
      const testLine = currentLine + word + ' ';
      const metrics = context.measureText(testLine);
      const testWidth = metrics.width;

      if (testWidth > maxWidth && currentLine !== '') {
        newLines.push(currentLine.trim());
        currentLine = word + ' ';
      } else {
        currentLine = testLine;
      }
    }

    newLines.push(currentLine.trim());
  }

  msgerInput.value = newLines.join('\n');
}



function sendMessage(event) {
  if (event) event.preventDefault();

  const msgText = msgerInput.value.trim();
  if (!msgText) return;

  appendMessage(PERSON_NAME, PERSON_IMG, "right", msgText);
  msgerInput.value = "";
  //Deactivate the moving part if detecting message send 
  stopLoading(); 

};
greetingresponse("Hi, welcome to Manufacturing assistant chat! Ask me any thing about your robotic project. Select language before getting started.");
msgerForm.addEventListener("submit", event => {
  event.preventDefault();

  const msgText = msgerInput.value;
  if (!msgText) return;

  appendMessage(PERSON_NAME, PERSON_IMG, "right", msgText);
  msgerInput.value = "";
  
  //botResponse(msgText);
  llama2resp(msgText,language_setdat['setlang']);
});
function semantic_check(email,data_semantic,transcript,project_name,data_splitter,data_json,value_set){
  //var data_semantic = {};
  //Update refdata dynamically via fetching
  var greeting_dat = ["Greeting"]
  var class_create= ['Create new project','Classification']
  var close_microphone = ['Close microphone']
  var open_microphone = ["Start microphone","Open microphone"]
  var download_generated_code = ["Download generated code"]
  var Ask_projects = ["Ask about current project"]
  var Need_exp = ["Need explaination"]
  var Need_help = ['Need help']
  var search_dat = ["Search current data"]
  var help_info = ['Help information']
  //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>.
                            //Chain of thought 
  var break_step = ["Ask to build"]
  var Define_dat = ["Define"]
  var Research_dat = ["Research"] 
  var Design_dat = ["Design"]
  var Choosing_dat = ['Choosing part']
  var Install_integrate_dat = ['Install and integrated']  
  var Integrated_sensor_dat = ['Integrated sensors and actuator']
  var develop_software = ["programming software"]
  var test_refine_dat = ["Test and refine"]
  var Deploy_and_use = ["Deploy and use"]   
  var need_to_know = ["Need to know"]
  var showcur = ['Show current selected part']
  var rotate_model = ['Rotate model']
  var move_model = ['Move model']
  try{
  fetch('/semantic_search_match',{
                          // Declare what type of data we're sending
                          headers: {
                          'Content-Type': 'application/json'
                        },
                       // Specify the method
                       method: 'POST',
                      // A JSON payload
                      body: JSON.stringify({
                               "email": email,"command":transcript,"project_name":project_name,"ref_data":['Create new project','Help information','Classification','Download generated code','Greeting',
                              'Ask about current project','Search current data',"Start microphone","Open microphone",'Close microphone','Need explaination','Need to know','Search current data','Show current selected part','Rotate model','Move model'] 
                      })
                      }).then(function (response) { // At this point, Flask has printed our JSON
                      return response.text();
                      }).then(function (text) {
                      console.log('POST response: ');
                      // Should be 'OK' if everything was successful 
                      var semantic_result = JSON.parse(text); // Get the semantic selection result
                      console.log("Semantic output:",semantic_result); //Get the result from the semantic to make the decision of feature selection     
                      //Create new project function 
                      //data_semantic['semantic'] =  semantic_result;
                      //Help information 

                      //Classfication  && Create new project function
                      //Output reference {'High_threshold_list': '{}', 'Low_threshold_list': '{"Create new project": "0.49558127"}', 'max_command': 'Create new project', 'max_confident': '0.49558127'}
                      //if(parseFloat(semantic_result.max_confident) >= 0.210){
                        data_semantic['semantic'] =  semantic_result;
                      
                        
                       //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

                        if(class_create.includes(semantic_result.max_command)== true){

                                    console.log("Selected semantic: ",semantic_result.max_command,semantic_result.max_confident);
                                    stopSpeechRecognition(); 
                                    probabilistic_semantic_function(transcript,data_splitter,data_json,value_set);
                                    status_selected['status'] = 'Classification'
                                      
                        }
                        //Download generated code 
                        if(download_generated_code.includes(semantic_result.max_command) == true){
                                    console.log("Selected semantic: ",semantic_result.max_command,semantic_result.max_confident); 
                                    console.log("Downloading software generated code");
                                    status_selected['status'] = 'Download generated code' 
                                    //Download_and_search(email,category_input) //download the generated fule function  
                       }   
                       //Greeting 
                       if(greeting_dat.includes(semantic_result.max_command) == true){
                                    console.log("Selected semantic: ",semantic_result.max_command,semantic_result.max_confident); 
                                    llama2_model_activate(transcript,value_set); // Geeting feature   
                                    status_selected['status'] = 'Greeting'        
                       }
                        
                       //Ask about current project analytic 
                       if(Ask_projects.includes(semantic_result.max_command) == true){
                                    console.log("Selected semantic: ",semantic_result.max_command,semantic_result.max_confident); 
                                    llama2_processing_project(transcript,value_set);
                                    status_selected['status'] = 'Ask about current project'
                       }

                       //Close microphone 
                       if(close_microphone.includes(semantic_result.max_command) == true){
                                    console.log("Selected semantic: ",semantic_result.max_command,semantic_result.max_confident); 
                                    stopSpeechRecognition(); 
                                    status_selected['status'] = 'Close microphone'
                       }
                       //open microphone
                       if(open_microphone.includes(semantic_result.max_command) == true){
                                    console.log("Selected semantic: ",semantic_result.max_command,semantic_result.max_confiden);
                                    startSpeechRecognition();
                                    status_selected['status'] = 'Open microphone'
                       }
                       //Need explaination 
                       if(Need_exp.includes(semantic_result.max_command) == true){
                                    console.log("Selected semantic: ",semantic_result.max_command,semantic_result.max_confident); 
                                     llama2_processing_project(transcript,value_set);
                                    status_selected['status'] = 'Need explaination'
                       }
                       if(Need_help.includes(semantic_result.max_command) == true){
                                    console.log("Selected semantic: ",semantic_result.max_command,semantic_result.max_confident); 
                                    llama2_processing_project(transcript,value_set);
                                    status_selected['status'] = 'Need help'
                       }
                       if(need_to_know.includes(semantic_result.max_command) == true){
                                    console.log("Selected semantic: ",semantic_result.max_command,semantic_result.max_confident); 
                                    llama2_processing_project(transcript,value_set);
                                    status_selected['status'] = 'Need to know'
                       }
                      
                       //Search current data
                       if(search_dat.includes(semantic_result.max_command) == true){
                                    console.log("Selected semantic: ",semantic_result.max_command,semantic_result.max_confident); 
                                    Search_current_data(transcript,value_set); //Get current data search 
                                    status_selected['status'] = 'Search current data'
                       }   
                       //Help info 
                       if(help_info.includes(semantic_result.max_command) == true){
                                    console.log("Selected semantic: ",semantic_result.max_command,semantic_result.max_confident); 
                                    Search_current_data(transcript,value_set); //Get current data search 
                                    status_selected['status'] = 'Help information'
                       } 
                       //Show current selected part 
                       if(showcur.includes(semantic_result.max_command) == true){
                                    console.log("Show current selected part");        
                                    visualize_selected_components(email);
                                    status_selected['status'] = 'selected part'
                       }
                       //Rotate model 
                       if(rotate_model.includes(semantic_result.max_command)== true){
                                    console.log("Selected semantic: ",semantic_result.max_command,semantic_result.max_confident);
                                    controls.forEach(control => control.setMode('rotate'));
                                    stopLoading();
                                    status_selected['status'] = 'Rotate model'
                       }
                       //Transform model 
                       if(move_model.includes(semantic_result.max_command)== true){
                                    console.log("Selected semantic: ",semantic_result.max_command,semantic_result.max_confident);
                                    controls.forEach(control => control.setMode('translate'));
                                    stopLoading();
                                    status_selected['status'] = 'Move model'

                       }

                       //Breaking step of thinking 
                       if(break_step.includes(semantic_result.max_command) == true){
                                    console.log("Selected semantic: ",semantic_result.max_command,semantic_result.max_confident); 
                                    //Get the semantic data check 
                                    //semantic_check(email,data_semantic,transcript,project_name,data_splitter,data_json,value_set); 
                                    console.log("Semantic reference function breakdown processing")
                                    //startLoading();       
                                    openModal();// Show the multi-agent breaking process and execute tasks 
                                    break_down_step(email,project_name,transcript,value_set); // Break down the step of the command transcript input 
                                    status_selected['status'] = 'Breaking step';
                                    //stopLoading();  
                                   //This loop will recheck the action inside the semantic itself and active the selected feature function 
                                    //break_step = [];
                                    //Clear selement inside the array 

                       }
                   // }

                    
              });
            }
            catch(err){
                 console.log("Semantic fetching error");
                 notify_data('error','Semantic processing server is down');
            }

}
function break_down_step(email,project_name,transcript,value_set){
         console.log("Activate the break down step function");
         //Fetching the break down step to get the data of matching semantic
         startLoading();   
         console.log("Language_output: ",matched_lang[value_set]); 
         fetch('/break_down_steps',{
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({
                                   "email": email,"project_name":project_name,"command":transcript,"lang":matched_lang[value_set]    //value_set   // Get the destiny language data to translate back the server reference   
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                                  var chain_thinking = JSON.parse(text); //Get the chain of thinking processing 
                                  //Running the hashing loop of the sub topic semantic data reltion to search for the matching function to trigger tools 
                                  console.log("Breaking down step of thinking: ",chain_thinking[email]);                         
                                  console.log("Translate step chain: ",chain_thinking['translate'][email][matched_lang[value_set]]); 
                                  botResponse(chain_thinking['translate'][email][matched_lang[value_set]]);
                                  speak(chain_thinking['translate'][email][matched_lang[value_set]],value_set);  
                                  //Fetching the data of the current breaking down data to processing in semantic link classification                                 
                                  stopLoading(); 
                          });

}
function llama2resp(trans_speak,value_set){
  if(value_set ==''){
          
        notify_data('warning','Please select language');
        //botResponse("Please select language on the language setting. If you want to use speech-to-text click on Talk with AI assistant or close microphone when you finish.");      
        translate_lang("Please select language on the language setting. If you want to use speech-to-text click on Talk with AI assistant or close microphone when you finish.","en")
  }

                      fetch('/translator_module',{
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({
                                   "email": email,"command":trans_speak,"dest_trans": matched_lang[value_set]    //value_set   // Get the destiny language data to translate back the server reference   
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                                  var trans_dat = JSON.parse(text); 
                                  console.log("Trans_data",trans_dat[email]); //Get the current user data  
                          console.log("Translate_main_data",trans_dat[email]['en']); 
                          
                          
                          const transcript = trans_dat[email]['en']    // Translate everything into eng 
                          //const transcript = trans_response["transdat"][email]['en'];  
                         
                             console.log(transcript);
                             
                             var data_splitter = word_ninja(transcript); // Get the word splitter to compare the data 
                             
                             //Fetch the language translation at the back-end processing 
                             var selected_command_list = {}; 
                             //Fetch the data send into the back-end to processing the data of the part selection 
                             // POST
                             notify_data("success","Listening ...")
                             stopLoading();
                             fetch('/speech_prompts', {
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({
                                   "email": email,"command":transcript
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          // Should be 'OK' if everything was successful
                                 //notify_data("success","Processing please wait...")
                                 startLoading();
                                 var data_json = JSON.parse(text);
                                 var check_error = Object.keys(data_json); //Get the data json function     
                                 if(check_error.includes('code') != true){
                                 console.log("Answer AI",data_json['command_ref']); 
                                 var projectname = document.getElementById("projname").value;
                                 semantic_check(email,data_semantic,trans_dat[email]['en'],projectname,data_splitter,data_json,value_set);
                                 //stopLoading();
                                 //probabilistic_semantic_function(transcript,data_splitter,data_json,value_set);   



                                 }
                                                                  
                          });
                            
                         
                      }); //End fetching trans here 
                              
                                    
                      
}
/*
function appendMessage(name, img, side, text) {
  //   Simple solution for small apps
  const msgHTML = `
    <div class="msg ${side}-msg">
      <div class="msg-img" style="background-image: url(${img})"></div>

      <div class="msg-bubble">
        <div class="msg-info">
          <div class="msg-info-name">${name}</div>
          <div class="msg-info-time">${formatDate(new Date())}</div>
        </div>

        <div class="msg-text">${text}</div>
      </div>
    </div>
  `;

  msgerChat.insertAdjacentHTML("beforeend", msgHTML);
  msgerChat.scrollTop += 500;
}
 */


 function appendMessage(name, img, side, text) {
  const isBot = side === "left";
  const msgId = `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
  const msgHTML = `
    <div class="msg ${side}-msg">
      <div class="msg-img" style="background-image: url(${img})"></div>
      <div class="msg-bubble">
        <div class="msg-info">
          <div class="msg-info-name">${name}</div>
          <div class="msg-info-time">${formatDate(new Date())}</div>
        </div>
        <div class="msg-text">${text}</div>
        ${isBot ? `
          <div class="msg-audio">
            <button class="play-audio-btn" id="play-${msgId}">
              üîä Play
            </button>
          </div>
        ` : ''}
      </div>
    </div>
  `;

  msgerChat.insertAdjacentHTML("beforeend", msgHTML);
  msgerChat.scrollTop += 500;

  // Add event listener for the play button if it's a bot message
  if (isBot) {
    const playButton = document.getElementById(`play-${msgId}`);
    const audio = document.getElementById(`audio-${msgId}`);
    playButton.addEventListener('click', toggleMute);
  }
}
function playAudiosdat() {
  // If audio is paused, resume playback
  if (audio && isPaused) {
      audio.play();
      isPaused = false;
     
      return;
  }
  var email = document.getElementById('email_account').value;
  // Fetch and play the audio file
  fetch('/text_speech/'+email+'/example.mp3')
      .then(response => {
          if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.blob();
      })
      .then(audioBlob => {
          const audioUrl = URL.createObjectURL(audioBlob);
          audio = new Audio(audioUrl);
          // Add event listener for when metadata is loaded
          audio.addEventListener('loadedmetadata', function() {
                const duration = audio.duration;
                //Store data of current duration data 

                console.log(`Audio duration: ${duration.toFixed(2)} seconds`);
                var string_duration = String(duration.toFixed(2)); 
                console.log("Duration parameter: ",typeof(duration.toFixed(2)),string_duration,typeof(string_duration)); //get the string duration time data 
                document.getElementById('audioduration').value = string_duration; //Get the audio duration 
                // Calculate minutes and seconds
                const minutes = Math.floor(duration / 60);
                const seconds = Math.floor(duration % 60);
                console.log(`Total length: ${minutes}:${seconds.toString().padStart(2, '0')}`);
                
            });

          audio.play();
          isPaused = false;

          // Add event listener for timeupdate
          audio.addEventListener('timeupdate', function() {
          const currentTime = audio.currentTime;
          console.log(`Current playback time: ${currentTime.toFixed(2)} seconds`);
          document.getElementById('current_audio').value = currentTime.toFixed(2); 
          
         });

         audio.onended = function() {
         console.log("Audio playback finished");
         startSpeechRecognition(); //Brring back speech recognition after detecting the audio is finished 
         audio = null;
         isPaused = false;
         URL.revokeObjectURL(audioUrl); // Clean up the URL object
       };
      })
      .catch(error => {
          console.error('Error fetching or playing audio:', error);
      });
}

function toggleMute() {
  console.log("Toggle mute function called");
  var email = document.getElementById('email_account').value;
  console.log("Playing audio of ",email);
  if (!audio) {
      console.warn('Audio is not initialized. Click Play first.');
      startSpeechRecognition();
      return;
  }

  if (audio.paused) {
      audio.play();
      isPaused = false;
      stopSpeechRecognition();
  } else {
      audio.pause();
      isPaused = true;
     
  }
}


function greetingresponse(payload_text){
  setTimeout(() => {
    appendMessage(BOT_NAME, BOT_IMG, "left", payload_text);
  },3);
  speak(payload_text,'en-US'); 
}
function botResponse(transcript) {
  //
  //const r = random(0, BOT_MSGS.length - 1);
  //const msgText = BOT_MSGS[r];

  setTimeout(() => {
    appendMessage(BOT_NAME, BOT_IMG, "left", transcript);
  },1);

  var languagedat = document.getElementById("languageset").value;
  fetch('/assistant_chat', {
    // Declare what type of data we're sending
    headers: {
      'Content-Type': 'application/json'
    },

    // Specify the method
    method: 'POST',

    // A JSON payload
    body: JSON.stringify({
        "email": email,"command":transcript,"destrans":languagedat
    })
}).then(function (response) { // At this point, Flask has printed our JSON
  return response.text();
}).then(function (text) {

  console.log('POST response: '); 
  var msgText = JSON.parse(text)[email];
  stopSpeechRecognition();
  /*
  //const delay = msgText.split(" ").length * 1;
  setTimeout(() => {
    appendMessage(BOT_NAME, BOT_IMG, "left", msgText);
  },1);
  */
    //Procesing the simantic search for the function matching in the speech here 
  //speak(msgText,languagedat);
});

};

// Utils
function get(selector, root = document) {
  return root.querySelector(selector);
}

function formatDate(date) {
  const h = "0" + date.getHours();
  const m = "0" + date.getMinutes();

  return `${h.slice(-2)}:${m.slice(-2)}`;
}

//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
function test_activation_speech_match(speech_end_point,data_splitter,display_response,prompts,probabilistic_activationres,user_account,transcript,value_set,functionselect,input_arguement){

              fetch('/'+String(speech_end_point), {
                            // Declare what type of data we're sending
                           headers: {
                              'Content-Type': 'application/json'
                           },
                           // Specify the method
                           method: 'POST',
                           // A JSON payload
                           body: JSON.stringify({
                                  "email": user_account,"command":transcript
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          // Should be 'OK' if everything was successful 
                          var activationres_json = JSON.parse(text);

                         console.log(display_response,activationres_json);
                         var activationres_dat = activationres_json[prompts]
                         console.log(display_response,activationres_dat); //Get the activationres data list  
                         console.log("Speech transcription", data_splitter); 
                         
                         var  activation_intersect = findIntersection(data_splitter,activationres_dat);
                         console.log('activationres_Intersection:', activation_intersect);
                         // Find and display the similarity
                         var  activation_similarity = findSimilarity(data_splitter,activation_intersect);
                         var vr = []
                         console.log('activationres_Similarity:', activation_similarity + '%'); 
                         if(activation_similarity >0){

                                         //Activate the data for the activation of the 
                                         console.log("Finding the data of similarity intersection data")
                                         notify_data("success","Finding the data of similarity intersection data");
                                         var vil = 0; 
                                         for(vil>1; vil<Object.keys(activationres_json).length;vil++){
                                             //console.log(activation_intersect,Object.keys(activationres_json)[vil],activationres_dat[Object.keys(activationres_json)[vil]]);
                                             console.log(activation_intersect,Object.keys(activationres_json)[vil],word_ninja(Object.keys(activationres_json)[vil])); //Finding the intersection of the data of key to find matching data 
                                             var key_matching = word_ninja(Object.keys(activationres_json)[vil]) 
                                             
                                             var activation_sub_intersect = findIntersection(activation_intersect,key_matching); 
                                             var activation_sub_similarity = findSimilarity(activation_sub_intersect,key_matching); 
                                             console.log("Sub Similarity intersection data ",activation_sub_similarity,activation_intersect,activation_sub_intersect); 
                                             if(activation_sub_similarity >30){
                                                              
                                                           console.log("Selected function of the sub similarity data ",activation_sub_intersect.join(" ")); // Get the result from the sub intersection  
                                                           multi_processing_function(transcript,functionselect,activation_sub_intersect.join(" "),value_set);

                                                                                                                       

                                             }
                                               
                                         }

                         }
 
            });
  }
function activation_speech(speech_end_point,data_splitter,display_response,prompts,probabilistic_activationres,user_account,transcript,value_set,functionselect,input_arguement){
                 console.log("Activate Free LLMs by activation and word calssification");
                 fetch('/'+String(speech_end_point), {
                                             // Declare what type of data we're sending
                                            headers: {
                                               'Content-Type': 'application/json'
                                            },
                                            // Specify the method
                                            method: 'POST',
                                            // A JSON payload
                                            body: JSON.stringify({
                                                   "email": user_account,"command":transcript
                                           })
                                           }).then(function (response) { // At this point, Flask has printed our JSON
                                           return response.text();
                                           }).then(function (text) {
                                           console.log('POST response: ');
                                           // Should be 'OK' if everything was successful 
                                           var activationres_json = JSON.parse(text);

                                          console.log(display_response,activationres_json);
                                          var activationres_dat = activationres_json[prompts]
                                          console.log(display_response,activationres_dat); //Get the activationres data list  
                                          console.log("Speech transcription", data_splitter); 
                                          
                                          var  activation_intersect = findIntersection(data_splitter,activationres_dat);
                                          console.log('activationres_Intersection:', activation_intersect);
                                          // Find and display the similarity
                                          
                                          var  activation_similarity = findSimilarity(data_splitter,activation_intersect);
                                          console.log('activationres_Similarity:', activation_similarity + '%');
                                          ///*
                                          if(activation_similarity > 0){

                                                      //Processing the data of the sub similarity comparation of the data category activationres selection 
                                                      console.log("Container sub data text processing activationres",data_splitter); 
                                                      //Finding the sub intersection to get the right selected highest possibility activationres detected 
                                                      var vil = 0; 
                                                      for(vil>1; vil<Object.keys(activationres_json).length;vil++){

                                                                     console.log("activationres data",Object.keys(activationres_json)[vil],activationres_json[Object.keys(activationres_json)[vil]]); 
                                                                     var  activation_sub_intersect = findIntersection(activation_intersect,activationres_json[Object.keys(activationres_json)[vil]]); 
                                                                     var  activation_sub_similarity = findSimilarity(activation_sub_intersect,activationres_json[Object.keys(activationres_json)[vil]]); 
                                                                     //Add the data into the list and find the maximum value for the data input 
                                                                     console.log(activation_similarity,Object.keys(activationres_json)[vil]); 
                                                                     probabilistic_activationres[activation_sub_similarity] = Object.keys(activationres_json)[vil]; //Get the probabilistic data to classify command 


                                                      }
                                                      var activation_select_prob = findMaxNumber(Object.keys(probabilistic_activationres))
                                                      console.log("Selected activationres from the list",activation_select_prob,probabilistic_activationres[activation_select_prob])
                                                      if(activation_select_prob > 4){


                                                                     if(probabilistic_activationres[activation_select_prob] != "activationres" && probabilistic_activationres[activation_select_prob] != "command_ref"){

                                                                                     console.log("Found activation selected",probabilistic_activationres[activation_select_prob]); //Output choosing data for the output activation controller condition
                                                                                     //speak("Accessing vector database",value_set); 
                                                                                     notify_data("success","Accessing vector database")
                                                                                     var results_data =  multi_processing_function(transcript,functionselect,probabilistic_activationres[activation_select_prob],value_set); 
                                                                                     console.log("Returning data",results_data); 
                                                                                     console.log("Activate Free LLMS model"); 
                                                                                     //Get the return value from the function of components_classification 
                                                                                     //LLM_model_activate(transcript,value_set); //Next time making it settable language models 
                                                                                     //Using the free pdf reader to run the langchain data processing
                                                                                     //Free_LLM_model_activate(transcript,value_set)
                                                                                     //Get the FreeLLM roca2_request 
                                                                                     //

                                                                                     
                                                                     }
                                                                   

                                                      }
                                              


                                          }
                                          //*/
                                           
                                            
                                             
                          });

 }       
 
 function multi_processing_function(transcript,functionselect,input_arguement,value_set){
              //Select each type of the function to control the function of each argument selected 
              console.log("Selected language data ",value_set); //Get the selected language data 
              if(functionselect == "clear_probabilistic_data"){
                           clear_probabilistic_data(input_arguement);
              }
              if(functionselect == "project_attention_mech"){
                           project_attention_mech(input_arguement);   
              }
              if(functionselect == "create_new_project"){
                           create_new_project(input_arguement);
              }
              if(functionselect == "Download_and_search"){
                
                          Download_and_search(input_arguement);         
              }
              if(functionselect == "LLM_model_activate"){
                                 
                          LLM_model_activate(input_arguement,value_set);

              }
              if(functionselect == "components_classification"){

                          components_classification(transcript,input_arguement,value_set); 
                          console.log("Argument datainput",transcript);
                          //check the activation intersection 
                         

              }
              if(functionselect == "Application_features_interface"){
                      
                          var results_data = Application_features_interface(input_arguement,value_set);  
                          return results_data;   
              }


 }

 function components_classification(transcript,components_data,value_set){
              console.log("Language selected",value_set); //Get the value language selected  
              console.log("Components classification function........ ["+components_data+"]"); //Extract the components classification function 
              notify_data("success","Feature extraction processing begin")  

              //translate_lang("Classifying components please wait",value_set);
              //Fetch the orca2 hear      
              //orca2_components_request(transcript,value_set); //Get the value set of the transcript input function           
              var intersect_comp =  word_ninja(transcript); //Find the intersect command functionality 
              console.log("List for intersection: ",intersect_comp);
              //var  activation_intersect = findIntersection(data_splitter,activationres_dat);
              //Fetch the intersection of the database of the classification to confirm the activation function 
              ///speech_components_classification
              
              fetch('/'+String("speech_components_classification"), {
                            // Declare what type of data we're sending
                           headers: {
                              'Content-Type': 'application/json'
                           },
                           // Specify the method
                           method: 'POST',
                           // A JSON payload
                           body: JSON.stringify({
                                  "email": email,"command":transcript
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          // Should be 'OK' if everything was successful 
                          var activationres_json = JSON.parse(text);
                          console.log("Activation json data processing",activationres_json); //Get the activationres to find intersection of thr transcript data  
                          console.log("Classification intersect activation ",activationres_json['component classify']); //Get the activationres intersection 
                          var intersect_classification = findIntersection(intersect_comp,activationres_json['component classify']); 
                          console.log("Intersection classification ",intersect_classification);

                          //Check similarity before start process 
                          console.log("Find similarity intersection: ",intersect_comp,intersect_classification);
                          var similarity =  findSimilarity(intersect_comp,intersect_classification);
                          //Get the data of the intersection similarity 
                          var get_project_data =  getUniqueWords(intersect_comp,intersect_classification);
          
                          console.log("Get the similarity percentage: ",similarity); //Get the data of  
                          //if(similarity >= 50){
                          console.log("Get the project data: ",get_project_data); //Get the project data components 
                          var join_projectdata = get_project_data.join(' '); 
                          console.log("Connect project data string: ",join_projectdata); 
                          //translate_lang("Processing components data"+join_projectdata+" please wait",value_set);
                          //Accessing the large language model prompt for the components data classification function 
                          orca2_components_request(get_project_data.join(' '),value_set); //Send the data to the back-end 
                          
                          //}
                          
              });            
              //document.getElementById('id01').style.display='block';
 }         
 //Extract the unique word of the transcript data 
 function getUniqueWords(list1, list2) {
    // Convert lists to sets for faster intersection checking
    const set1 = new Set(list1);
    const set2 = new Set(list2);

    // Filter out words present in both lists and concatenate the unique words from each list
    const uniqueWordsList1 = list1.filter(word => !set2.has(word));
    const uniqueWordsList2 = list2.filter(word => !set1.has(word));
    
    return [...uniqueWordsList1, ...uniqueWordsList2];
}
 //Feature of the website 
 function Application_features_interface(input_system,value_set){  
                 //Application control system control the code here 
                 var list_selection = {"navigation system":"https://roboreactor.com","motion control system":"https://roboreactor.com","download file":"command download","upload code":"upload data","generate code":"generate the code "}        
                 console.log("Open ",input_system);
                 speak("Open "+input_system,value_set);
                 notify_data("success","Activate "+input_system); 
                 //Open the link for the profile page data  

                 return input_system              
                
 }
 function clear_probabilistic_data(probabilistic){
        //probabilistic_answer.clear();
        var ty = 0; 
        for(ty>0; ty <Object.keys(probabilistic).length;ty++){

                        console.log("Prob_answer",Object.keys(probabilistic)[ty]);
                        delete probabilistic[Object.keys(probabilistic)[ty]]; //clear the list notification 
                        console.log("Clear short memory")
        }  
 }         
 function project_attention_mech(extract_projectname){
                                             var last_element_detect = ["project","name","call","called","is"]
                                             var project_statement = [] //Save the project statement data of the current project 
                                             var bw = 0; 
                                             console.log("Detecting the project name",extract_projectname[extract_projectname.length-1]);
                                             //Running the for loop backward to detect the project and break 
                                             //Running the list backward by detecting the data   
                                             for(bw=extract_projectname.length-1 ;bw >0; bw--){
                                                          console.log("Reverse input",extract_projectname[bw]);
                                                          //Put the data reverse into the project_statement 
                                                          project_statement.push(extract_projectname[bw]) 
                                                          //If detected the found element detect in the list then stop 
                                                          if(extract_projectname.includes(extract_projectname[bw]) == true){ 
                                                               
                                                               break;
                                                          }
                                             }                       
                                             console.log("Get the current project name",[...project_statement].reverse());
                                             
                                             if(last_element_detect.includes([...project_statement].reverse()[0]) == false){                   
                                                                  speak("Your current project name is "+[...project_statement].reverse()[0],value_set)
                                                                  notify_data("success","Your current project name is "+[...project_statement].reverse()[0]);
                                             }
                                             if(last_element_detect.includes([...project_statement].reverse()[0]) == true || [...project_statement].reverse()[0] == ""){
                                                                   speak("Please repeat your project name again",value_set); 
                                                                   notify_data("warning","Please repeat your project name again");
                                             }
                                             

 }
 //Create the new project function from the input feature 
 function create_new_project(projectname){
  
              console.log("Creaating new project...."); 
              fetch('/create_new_project', {
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({

                                   "email": email,"payload_category":category_input
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          var new_project = JSON.parse(text); // Get the data feedback from the back-end 
                          console.log(new_project); //Create the new project at the back-end by define the user email account to feedback  
                      
               });
              

 }
 //Downlod search data from the internet 
 function Download_and_search(email,category_input){
                console.log("Downloading the data for training......."); 
                fetch('/download_datasearch', {
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({

                                   "email": email,"payload_category":category_input
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          // Should be 'OK' if everything was successful 
                          var download_data  = JSON.parse(text); //Download the data search from the system 
                          console.log(download_data); // 
                         

                  }); 
             

 }
 //Large language model input 
 function LLM_model_activate(transcript,value_set){
              fetch('/speech_command_concurrency', {
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({
                                   "email": email,"command":transcript
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          // Should be 'OK' if everything was successful 
                                 var data_json = JSON.parse(text);
                                 console.log("Answer AI",data_json); 
                                 //notify_data("success",data_json['answer']['kornbot380@hotmail.com']['Answer'])
                                 condition_notify("success",data_json['answer'][email]['Answer'])
                                 speak(data_json['answer'][email]['Answer'],value_set);
              });
 }
 //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
   // Array of URLs to be used in the iframes
  

   function components_selected_mmai(urls) {
        // Function to populate the slider with iframes
        function populateSlider() {
            const slider = document.getElementById('components-slider');

            urls.forEach((url) => {
                const frame = document.createElement('div');
                frame.classList.add('frame3');

                const iframe = document.createElement('iframe');
                iframe.src = url; // Set the iframe URL
                iframe.width = '110%'; // Make iframe fill the frame
                iframe.height = '110%'; // Make iframe fill the frame
                iframe.frameBorder = '0'; // Remove border
                iframe.scrolling = 'no'; // Disable autoscrolling in iframe                      
                frame.appendChild(iframe); // Append iframe to the frame
                slider.appendChild(frame); // Append frame to the slider
            });
        }

        // Function to open the modal
        function componentsModal() {
            document.getElementById('components_modal').style.display = 'flex';
            populateSlider(); // Populate slider when modal opens
        }
        componentsModal(); 

    } 

        // Function to close the modal
function closeModalcom() {
            document.getElementById('components_modal').style.display = 'none';
            const slider = document.getElementById('components-slider');
            slider.innerHTML = ''; // Clear the slider contents when closing
            
    }

window.onclick = function(event) {
            const modal = document.getElementById('components_modal');
            if (event.target === modal) {
                closeModalcom();
            }
}

 //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
 //Function to request and get the data from the orca2 components requests 
 function orca2_components_request(data_project,value_set){
                 //if(transcript.length > 25){
                      //speak("Processing please wait",'en');
                //translate_lang("Processing please wait",value_set);      
                 //}  
                 //Processing the transcript to detecting the project requirement in the data and split data 
                 startLoading();
                 //Start opening modal system to visualize task processing of the multi agent system 
                 openModal(); //Open the modal for the multi-agent progress task 
                 fetch('/orca2_free_llms_concurrency',{
                          headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({
                                   "email": email,"command":data_project
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          // Should be 'OK' if everything was successful 
                                 var comp_json = JSON.parse(text); 
                                 console.log("Get the component request output",comp_json[email]); //Get the data components output 
                                 
                                 /*
                                 if(Object.keys(comp_json[email]).length != 0){
                                               //translate_lang("Successful processing components!",value_set);
                                               //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
                                               //Fetch the data of the selected link 
                                               
                                              
                                               fetch('/current_projs', {
                                                  // Declare what type of data we're sending
                                                  headers: {
                                                  'Content-Type': 'application/json'
                                                 },
                                                 // Specify the method
                                                method: 'POST',
                                               // A JSON payload
                                               body: JSON.stringify({
   
                                                           "email": email
                                              })
                                              }).then(function (response) { // At this point, Flask has printed our JSON
                                              return response.text();
                                              }).then(function (text) {
                                             console.log('POST response: ');
                                             var data_projectadd = JSON.parse(text);
                                              console.log("Get current project data",data_projectadd);  
                                              try{
                                               fetch('/selected_components',{
                                                              headers: {
                                                           'Content-Type': 'application/json'
                                                   },
                                                // Specify the method
                                                method: 'POST',
                                                // A JSON payload
                                               body: JSON.stringify({

                                                      "email": email,"project_name":data_projectadd['project_name']
                                               })
                                             }).then(function (response) { // At this point, Flask has printed our JSON
                                             return response.text();
                                             }).then(function (text) {
                                                console.log('POST response: ');
                                                // Should be 'OK' if everything was successful 
                                                    var compselect = JSON.parse(text); 
                                                    console.log("Automate selected data: ",compselect);
                                                    var datr =0; 
                                                    var urls = []; 
                                                    //startLoading();

                                                    for(datr >0;datr <=compselect.length;datr++){
                                                                
                                                                if(compselect[datr] != undefined){
                                                                  console.log("Category encoding: ",compselect[datr]); 
                                                                     //Check if the components is in the range of the directory components category 
                                                                     var categorycheck_list = ["Audio_system","Battery","Communication_system","Microcontroller","Motion_system","Navigation_system","Odometry_system","Sensor_array_to_image_system","Sensors","Single_Board_computer","Vision_system"]
                                                                     if(categorycheck_list.includes(compselect[datr]) == true){
                                                                            var url_encode_payload = {"email":email,"project_name":data_projectadd['project_name'],"category":compselect[datr]}
                                                                            var encode_urls = btoa(JSON.stringify(url_encode_payload)); 
                                                                            console.log(compselect[datr],encode_urls,typeof(encode_urls));     
                                                                            var urls_encoder =  "https://roboreactor.com/components_loader_selected/"+String(encode_urls);                                                             
                                                                            urls.push(urls_encoder); 
                                                                     }
                                                                }
                                                         
                                                    }
                                                    closeModal();
                                                    console.log("List urls: ",urls); 
                                                    components_selected_mmai(urls);
                                                    //Fetch back the data from ponents for the link url selected in the project 
                                                    stopLoading();
                                                  
                                                   }); 
                                              }
                                              catch{
                                                   console.log("Internal semantic categorizer server error");
                                                   notify_data('warning',"Components categorization server error");
                                              }
                                                });
                                              

                                               
                                               //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
                                 }
                                 if(Object.keys(comp_json[email]).length == 0){

                                               translate_lang("Fail to search components.Try to ask me again",value_set);
                                               stopSpeechRecognition();
                                               //Trigger constant speech recognition function trigger 
                                 }
                                 */
                                 //Processing the modal trigger to open the components selected by automated assembly 
                                 //Fetch the end-point features_Selector for the AI selected components data 

         

                  
                                                                
                 })

 } 



 //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
 //Extract the free large language model data for the production using Falcon-7B components classification  
 function Free_LLM_model_activate(transcript,value_set){   
                     if(transcript.length > 25){
                       
                      //speak("Processing please wait",'en');
                      //translate_lang("Processing please wait",value_set);  
                     
                     }   

                     fetch('/speech_free_llms_concurrency',{
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({
                                   "email": email,"command":transcript
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          // Should be 'OK' if everything was successful 
                                 var data_json = JSON.parse(text);
                                 console.log("Answer AI",data_json); 
                                 notify_data("success",data_json['answer'][email]['text_answ'])
                                 //condition_notify("success",data_json['answer'][email]['Answer'])
                                 speak(data_json['answer'][email]['text_answ'],value_set);

              });   
 }
//Extract llama2 large language model 
 function llama2_model_activate(transcript,value_set){   
                     //Checking the length of the word before saying processing 
                     if(transcript.length > 25){
                      
                          //speak("Processing please wait",'en');
                          //translate_lang("Processing please wait",value_set);  
                         
                     } 
                     //var translate_transcript = translate_lang(transcript,value_set); //get 'en' transcript
                     //console.log("Tranlated lang",translate_transcript);                     
                     fetch('/speech_llama2_async',{
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({
                                   "email": email,"command":transcript+" answer me in short and clear answer","dest_lang": matched_lang[value_set]
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          // Should be 'OK' if everything was successful 
                                 var data_json = JSON.parse(text);
                                 console.log("Answer AI",data_json); 
                                 //notify_data("success",data_json['translate'])
                                 //infonotify(data_json['translate'])
                                 //condition_notify("success",data_json['answer'][email]['Answer'])
                                 //translate_lang(data_json['answer'][email],value_set); //Get the output translator from the language input into the system 
                                 botResponse(data_json['translate']); 

                                 speak(data_json['translate'],value_set);
                                 

              });   
 }
 function agent_voicedat(text){
          console.log("Fetching text data");

 }
 function llama2_processing_project(transcript,value_set){   
                     //Checking the length of the word before saying processing 
                     if(transcript.length > 25){
                      
                          //speak("Processing please wait",'en');
                         // translate_lang("Processing please wait",value_set);  
                         
                     } 
                     startLoading();
                     //var translate_transcript = translate_lang(transcript,value_set); //get 'en' transcript
                     //console.log("Tranlated lang",translate_transcript);                     
                     fetch('/speech_llama2_async',{
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({
                                   "email": email,"command":transcript+" answer me in short and clear answer","dest_lang": matched_lang[value_set]
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          // Should be 'OK' if everything was successful 
                                 var data_json = JSON.parse(text);
                                 console.log("Answer AI",data_json); 
                                 //notify_data("success",data_json['translate'])
                                 //infonotify(data_json['translate'])
                                 //condition_notify("success",data_json['answer'][email]['Answer'])
                                 //translate_lang(data_json['answer'][email],value_set); //Get the output translator from the language input into the system 
                                 botResponse(data_json['translate']); 
                                 speak(data_json['translate'],value_set);
                                 stopLoading();

              });   
  
 }
 function Search_current_data(transcript,value_set){   
                     //Checking the length of the word before saying processing 
                     if(transcript.length > 25){
                      
                          //speak("Processing please wait",'en');
                         // translate_lang("Processing please wait",value_set);  
                         
                     } 

                    //Fetch the data search at the back-end to processing in the speech llama2 to processing the data from search 

                     fetch('/speech_llama2_async',{
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({
                                   "email": email,"command":transcript+" answer me in short and clear answer","dest_lang": matched_lang[value_set]
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          // Should be 'OK' if everything was successful 
                                 var data_json = JSON.parse(text);
                                 console.log("Answer AI",data_json); 
                                 //notify_data("success",data_json['translate'])
                                 //infonotify(data_json['translate'])
                                 //condition_notify("success",data_json['answer'][email]['Answer'])
                                 //translate_lang(data_json['answer'][email],value_set); //Get the output translator from the language input into the system 
                                 botResponse(data_json['translate']); 
                                 speak(data_json['translate'],value_set);
                                 

              });   
  
 }
 function translate_lang(transcript,value_set){
                         fetch('/translator_module',{
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({
                                   "email": email,"command":transcript,"dest_trans":matched_lang[value_set]  
                                   // Get the destiny language data to translate back the server reference   
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                                  var trans_dat = JSON.parse(text); 
                                  //console.log("Trans_data",trans_dat,value_set.split("-")[0]);
                                  //Fetch the data of the language components matching from the back-end

                                  //notify_data("success",trans_dat[email][value_set.split("-")[0]])
                                  //speak(trans_dat[email][value_set.split("-")[0]],value_set); 
                                  fetch('/language_braviation_match',{
                              // Declare what type of data we're sending
                                              headers: {
                                             'Content-Type': 'application/json'
                                        },
                                        // Specify the method
                                         method: 'POST',
                                        // A JSON payload
                                       body: JSON.stringify({
                                       "email": email,"dest_lang":value_set  // Get the destiny language data to translate back the server reference   
                                   })
                                   }).then(function (response) { // At this point, Flask has printed our JSON
                                  return response.text();
                                  }).then(function (text) {
                                   console.log('POST response: ');
                                   var get_langbrev = JSON.parse(text); 
                                   console.log("Get language breviation data: ",get_langbrev,);
                                   console.log("Hashing_langbrev",get_langbrev[email][value_set]);
                                   var get_matchedlang = get_langbrev[email][value_set]; 
                                   notify_data("success",trans_dat[email][get_matchedlang])
                                   botResponse(trans_dat[email][get_matchedlang]);
                                   speak(trans_dat[email][get_matchedlang],value_set); // Get the language match from the api back-end 
                                   
                              });
                                    
                                  
                        });
                       

 }
 function search_existing_project(email,result_refsearch,projectname_data,value_set){
               //result_refsearch["Created_project"] = projectname_data; 
               console.log("Fetch new data of the current project ",email,result_refsearch,projectname_data); // Fetch the current project data 
               //Fetch the project name to search existing project 
               // /search_projectname
               fetch('/add_projectname',{
                              // Declare what type of data we're sending
                                              headers: {
                                             'Content-Type': 'application/json'
                                        },
                                        // Specify the method
                                         method: 'POST',
                                        // A JSON payload
                                       body: JSON.stringify({
                                       "email": email,"projectname":projectname_data  // Get the destiny language data to translate back the server reference   
                                   })
                                   }).then(function (response) { // At this point, Flask has printed our JSON
                                  return response.text();
                                  }).then(function (text) {
                                   console.log('POST response: ');
                                   var data_projs= JSON.parse(text); 
                                   console.log("project data",data_projs);
                                   if(Object.keys(data_projs[email]) == "Existing_project"){
                                                    console.log("This project is already created"); // Existing project detected
                                                    var date_data = data_projs[email]["Existing_project"][projectname_data];      
                                                    var datedata = date_data.split(" ")[0]; 
                                                    var date_extract = date_data.split(" ")[0].split("-")
                                                    translate_lang("This project was already created in date "+datedata,value_set)
                                                    //Asking for editing the project 
                                                    translate_lang("Do you want to edit project "+projectname_data+"?",value_set); 
                                                    //Activate the project modal edited 
                                                    document.getElementById('id01').style.display='block';
                                                    document.getElementById("projname").value = projectname_data;


                                   }   
                                   if(Object.keys(data_projs[email]) != "Existing_project"){
                                        
                                                   console.log("This project have not been created");
                                                   //Activate the project directory to created 
                                                   //Fetch to create the project data 
                                                 
                                                   document.getElementById('id01').style.display='block';
                                                   document.getElementById("projname").value = projectname_data;


                                   }
                                  
                                   


              });
               
               
                    
           
  
 }
 
 function modal_project_edit(email,projectname_data,value_set){
        
        console.log("Project data edit features and function")
        

 }
 
 //Getting the text input from the data input 
 function findMaxNumber(numbers) {
  if (numbers.length === 0) {
    // Handle the case where the list is empty
    return undefined;
  }

  let maxNumber = numbers[0]; // Assume the first number is the maximum

  for (let i = 1; i < numbers.length; i++) {
    if (numbers[i] > maxNumber) {
      // Update the maximum number if a larger number is found
      maxNumber = numbers[i];
    }
  }

  return maxNumber;
}
 // Function to find the intersection of two arrays
function findIntersection(arr1, arr2) {
    return arr1.filter(value => arr2.includes(value));
}

// Function to find the similarity of two arrays
function findSimilarity(arr1, arr2) {
    const intersection = findIntersection(arr1, arr2);
    const totalUniqueElements = new Set([...arr1, ...arr2]).size;
    const similarityPercentage = (intersection.length / totalUniqueElements) * 100;
    return similarityPercentage.toFixed(2); // Round to 2 decimal places
}
 
 function word_ninja(text){
 
  const words = text.trim().split(/\s+/);
  return words    //Returning the word ninja  

 }


 function speak(text,lang) {
            //var textToSpeak = document.getElementById('textToSpeak').value;
            //var rate = document.getElementById('rate').value;
            //var language = document.getElementById('language').value;
            /*
            const voices = window.speechSynthesis.getVoices()
            var utterance = new SpeechSynthesisUtterance();
            utterance.text = text;
            utterance.rate = parseFloat("1");
            utterance.lang = lang;
            speechSynthesis.speak(utterance);
            */
            stopSpeechRecognition();
            var email = document.getElementById('email_account').value;
            fetch('/audio_data_gen', {
   
              // Declare what type of data we're sending
              headers: {
               'Content-Type': 'application/json'
              },

             // Specify the method
             method: 'POST',
              // A JSON payload
              body: JSON.stringify({
             "email":email,"command":text,"lang":matched_lang[lang]
             })
           }).then(function (response) { // At this point, Flask has printed our JSON
           return response.text();
          }).then(function (text) {
          console.log('POST response: '); 
          var msgText = JSON.parse(text)
          console.log("Feed back test: ",msgText);
          //Trigger audio to play here 
          playAudiosdat();

});


 }
 //Notification data input 
 function notify_data(status,text){
        toastr.options = {
             "closeButton": true,
             "newestOnTop": false,
             "progressBar": true,
             "positionClass": "toast-top-center",
             "preventDuplicates": false,
             "onclick": null,
             "showDuration": "300",
             "hideDuration": "1000",
             "timeOut": "5000",
             "extendedTimeOut": "1000",
             "showEasing": "swing",
             "hideEasing": "linear",
             "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
           }
           if(status == 'success'){
              toastr.success(text); // if status success 
           }
           if(status == 'warning'){
              toastr.warning(text); 
           }
           if(status == 'error'){
              toastr.error(text); 
           }
            
  }
  function infonotify(longText) {
    toastr.options = {
      closeButton: true,
      positionClass: 'toast-slider',
      timeOut: '0',
      extendedTimeOut: '0'
    };
    toastr.clear();

    // Large text to demonstrate scrolling
    //var longText = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam. Sed nisi.";

    // Generate a single notification with long text
    var notification = "Answer: " + longText.repeat(5); // Repeat the long text to make it longer
    var toastContent = $('<div class="scrollable-content"></div>').text(notification);
    toastr.info(toastContent.prop('outerHTML'));
    
  } 
 
 function condition_notify(success,text){
  Command: toastr[success](text+"<br /><br /><button type='button' class='btn clear'>Close</button>")

  toastr.options = {
  "closeButton": true,
  "debug": false,
  "newestOnTop": false,
  "progressBar": false,
  "positionClass": "toast-top-center",
  "preventDuplicates": false,
  "onclick": null,
  "showDuration": "300",
  "hideDuration": "1000",
  "timeOut": 0,
  "extendedTimeOut": 0,
  "showEasing": "swing",
  "hideEasing": "linear",
  "showMethod": "fadeIn",
  "hideMethod": "fadeOut",
  "tapToDismiss": false
  }

 }
         // Modal functionality
        var  tabsData = [
            { 
                name: 'Multi-agent tasks', 
                content: `<div id="radarChart"></div>`
            }
        ];
        const modal = document.getElementById('modal');
        let tabSwitchInterval;

        function openModal() {
            modal.style.display = 'block';
           //Adding some tab function into the system 

           setTimeout(() => {
             Plotly.Plots.resize('radarChart');
           }, 100); // Delay to ensure modal is rendered
           //autoClickTab(tabindex);
        }
        function stopRandomTabSwitching() {
            clearInterval(tabSwitchInterval);
        }
       
        function closeModal() {
            modal.style.display = 'none';
            //stopRandomTabSwitching(); // Stop random tab switching
        }

        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                closeModal();
            }
        });

        // Dynamic Tabs Creation
        const tabContainer = document.getElementById('tabContainer');
        const tabContentContainer = document.getElementById('tabContentContainer');

       

        function createTabs() {
            tabsData.forEach((tab, index) => {
                const tabButton = document.createElement('button');
                tabButton.innerText = tab.name;
                tabButton.className = 'tablinks';
                tabButton.dataset.tabId = `tab${index}`;
                tabButton.onclick = (evt) => openTab(evt, `tab${index}`);

                tabContainer.appendChild(tabButton);

                const tabContent = document.createElement('div');
                tabContent.id = `tab${index}`;
                tabContent.className = 'tab-content4';
                tabContent.innerHTML = tab.content;

                tabContentContainer.appendChild(tabContent);
            });

            document.querySelector('.tablinks').classList.add('active');
            document.querySelector('.tab-content4').classList.add('active');
        }

        function openTab(evt, tabId) {
            const tabcontents = document.querySelectorAll('.tab-content4');
            tabcontents.forEach(tab => tab.classList.remove('active'));

            const tablinks = document.querySelectorAll('.tablinks');
            tablinks.forEach(tab => tab.classList.remove('active'));

            document.getElementById(tabId).classList.add('active');
            evt.currentTarget.classList.add('active'); const tabsData = [
            { 
                name: 'Multi-agent tasks', 
                content: `<div id="radarChart"></div>`
            }
        ];
        }

        // Auto-click Tab Function
        function autoClickTab() {
            const tabButtons = document.querySelectorAll('.tablinks');
            const randomIndex = Math.floor(Math.random() * tabButtons.length);
            tabButtons[randomIndex].click();
        }

        // Start Random Tab Switching
       

        // Stop Random Tab Switching
     
        // Example JavaScript function for interactive buttons
        function showAlert(message) {
            alert(message);
        }

        // Initialize Tabs on Page Load
        createTabs();
   
        var email = document.getElementById('email_account').value;
        fetch('/current_projs', {
                              // Declare what type of data we're sending
                              headers: {
                              'Content-Type': 'application/json'
                            },
                           // Specify the method
                           method: 'POST',
                          // A JSON payload
                          body: JSON.stringify({

                                   "email": email
                          })
                          }).then(function (response) { // At this point, Flask has printed our JSON
                          return response.text();
                          }).then(function (text) {
                          console.log('POST response: ');
                          var data_projectadd = JSON.parse(text);
                          console.log("Get current project data",data_projectadd); 
        //});   
        function multi_agent_task_progress(){
        //Setting the status here to trigger the loop selection function   
   
        fetch('/multi_agent_task', {

              // Declare what type of data we're sending
              headers: {
                 'Content-Type': 'application/json'
              },

             // Specify the method
             method: 'POST',

            // A JSON payload
            body: JSON.stringify({
                   "email": email,'project_name':data_projectadd['project_name']
            })
           }).then(function (response) { // At this point, Flask has printed our JSON
           return response.text();
          }).then(function (text) {
          console.log('POST response: ');
          // Should be 'OK' if everything was successful
          console.log(text);
          var payloaddat = JSON.parse(text);

          var payload_progress = payloaddat['component_search'];
          console.log("current progress payload: ",payload_progress);
          if(Object.keys(payload_progress).includes('Non_function') == true){
                 if(Object.keys(payload_progress).length >1){
                           delete Object.keys(payload_progress).Non_function;
                           console.log("Current payload ready",payload_progress); 
                 }
          }
          //var payload_progress = {'components_classification':50,'search_link_url':70,'Generate_CAD_3D_modal':80}
          const categories = Object.keys(payload_progress);  
          let taskProgress = [0, 0, 0, 0, 0, 0]; // Initial progress

          var task_num = categories.length; 
          var refval = []; 
          var refcomp = {};
          console.log("Number of task: ",task_num);
           
          if(task_num = categories.length){
                                   //var sum_per = sum(Object.values(payload_progress)); 
                                   
                                   console.log("Sum the percentage load of work: ",Object.values(payload_progress)) //,sum_per);
                                   var data_sum = Object.values(payload_progress);
                                   let sum = 0;
                                   for (let i = 0; i < data_sum.length; i++) {
                                          sum += data_sum[i];
                                   }
                                   console.log("Sum of process",sum,(sum/(100*task_num))*100);
                                   var total_payloadper = (sum/(100*task_num))*100; 
                                   if(total_payloadper != 100){
                                          var reflen = refval.length;
                                          if(reflen >2){
                                                  reflen.pop(0);
                                          }
                                          if(reflen[0] != reflen[1]){
                                                  taskProgress = []; 
                                          }  

                                   }  
                                  
                                  if(total_payloadper == 100){
                                          console.log("Processing close modal protocol ...");
                                          //Open the components selected by AI modal pop up here
                                          //stopRandomTabSwitching(); 
                                          //processing_data_selected_components(email);
                                          if(refcomp == {}){   
                                               refcomp['status']  = 'complete'; 
                                          }
                                          if(refcomp !={}){
                                               console.log('processing complete !');
                                               stopLoading(); 
                                               closeModal(); 
                                               processing_data_selected_components(email);   
                                               //Load multimodal based number of each compomponent with label successfully 
                                               get_selected_part(email,data_projectadd['project_name'],"selected_ai");
                                                                                         
                                              
                                              
                                          }

                                   }
                                   if(total_payloadper != 100){
                                            console.log("Progress incomplete task processing") 
                                            refcomp = {}; //Clear the reference status 
                                   }
                                  

         }
         //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
         //Fetch loading detecting thre model to load here 
         fetch('/current_selected_status', {
           // Declare what type of data we're sending  
            headers: {
                       'Content-Type': 'application/json' 
            },
           // Specify the method
           method: 'POST',
          // A JSON payload
          body: JSON.stringify({
                  "email": email,"project_name":data_projectadd['project_name']
          })
          }).then(function (response) { // At this point, Flask has printed our JSON
          return response.text();
         }).then(function (text) {
          console.log('POST response: ');
          // Should be 'OK' if everything was successful
          console.log(text);
          var data_selected = JSON.parse(text); 
          console.log("Selected data: ",data_selected,typeof(data_selected));
          
          var mode = data_selected['mode']; //Get mode 
          var status_selector = data_selected['status_selector'] //Get the status selector data 
          var payload_file = data_selected['payload_file']; //Get payload file 
          //var filename = payload_file[email]['Sub_file']; //File name payload 
          //var quantity = payload_file[email]['Quantity']; //Get quantity of component required in the process 

          if(data_selected != {}){
                     console.log("Loading model here !");  
                     //console.log("Loading the selected model",mode,status_selector,typeof(status_selector),payload_file,typeof(payload_file));

                     //state_rightclick['status'] = true;
                     if(status_selector == "True"){   
                             
                            console.log("Checking mode of the payloa selector: ",mode,typeof(mode));

                          
                            if(mode == "Load model"){
                                //Load model selection here 
                                console.log("Load selected model",payload_file);
                                //Load the model selection here 
                                 var filename = payload_file[email]['Sub_file']; //File name payload 
                                 var quantity = payload_file[email]['Quantity']; //Get quantity of component required in the process 
                                 var category = payload_file[email]['project_file'];
                                 console.log("Sub_file load model: ",filename);
                                 console.log("Quantity load model: ",quantity);   
                                 //Fetch the latest model position of each category to not use the same position added into the system 
                                 for(let comnum = 0; comnum<=quantity-1;comnum++){
                                          model_loader_function([filename],email,data_projectadd['project_name'],category,comnum*0.3,comnum*0.3,0); 
                                 }
                                 //load_multiple_selected_model([filename],email,data_projectadd['project_name'],"selected_com_num");

                            }
                            if(mode == "Remove model"){
                                //Remove model selection here
                                console.log('Remove the selected model'); 
                                var filename = payload_file[email]['Sub_file']; //File name payload 
                                var quantity = payload_file[email]['Quantity']; //Get quantity of component required in the process 
                                var category = payload_file[email]['project_file'];
                                console.log("Sub_file load model: ",filename);
                                console.log("Quantity load model: ",quantity);  
                                console.log("Removing file");  
                                //removeModelByName(filename); //Remove the components from the system 

                            }
                            
                     }
                     
                    //Then Fetch the data of logic back to the server status 
                    fetch('/update_logic_status', {
                         // Declare what type of data we're sending  
                         headers: {
                               'Content-Type': 'application/json' 
                         },
                       // Specify the method
                        method: 'POST',
                      // A JSON payload
                       body: JSON.stringify({
                           "email": email,"project_name":data_projectadd['project_name'],"mode":mode,"status_selector":"False","payload_file":payload_file   
                      })  //Send the payload file back with the update logic status
                    }).then(function (response) { // At this point, Flask has printed our JSON
                    return response.text();
                    }).then(function (text) {
                    console.log('POST response: ');
                    // Should be 'OK' if everything was successful
                   console.log(text);
                   var update_selected = JSON.parse(text); 
                   console.log("Update logic: ",update_selected);
                   

                 }); 
          }

         });

         //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  
          //let activeTasks = [true, true, true, true, true,true]; // Active tasks 
         //Fetching the model selection here if working  
          // Simulated concurrent updates per task
         function updateTaskProgress() {
                 let currentTask = 0;
                 for(currentTask >0;currentTask<=categories.length;currentTask++){
                         
                          taskProgress[currentTask]=payload_progress[categories[currentTask]];
                           
                          
                 }
                 updateRadarChart();
                 console.log("Fetching the multi-agent task: ",payload_progress);
         }

        // Initial chart setup
        const layout = {
           polar: {
                  radialaxis: {
                  visible: true,
                  range: [0, 100]
             }
        },
        showlegend: false,
        title: 'Concurrent Task Progress of Multi-agent'
      };

    const data = [{
        type: 'scatterpolar',
        r: taskProgress,
        theta: categories,
        fill: 'toself',
        name: 'Task Progress',
        marker: { color: 'green' }
    }];

    Plotly.newPlot('radarChart', data, layout);



    // Function to update the radar chart dynamically
    function updateRadarChart() {
        Plotly.update('radarChart', {
            r: [taskProgress]  // Update the progress values
        });
    }

    // Function to update the console display
   
    var r= 4;
        for(r>0;r<=4;r++){
           updateTaskProgress();
    }
    // Start the animation loop with setInterval
    //setInterval(updateTaskProgress, 1); // Update every 500ms

    window.addEventListener('resize', () => {
         Plotly.Plots.resize('radarChart');
    });
});
    
 //Loop internal function end here 
      }
    setInterval(multi_agent_task_progress, 3);
    animate(multi_agent_task_progress);
             //autoClickTab();
      
 


  });
    
        </script>
    <script>
      document.getElementsByClassName("tablink")[0].click();
      
      function openCity(evt, cityName) {
        var i, x, tablinks;
        x = document.getElementsByClassName("city");
        for (i = 0; i < x.length; i++) {
          x[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablink");
        for (i = 0; i < x.length; i++) {
          tablinks[i].classList.remove("w3-light-grey");
        }
        document.getElementById(cityName).style.display = "block";
        evt.currentTarget.classList.add("w3-light-grey");
      }
      </script>    
      <script src='https://use.fontawesome.com/releases/v5.0.13/js/all.js'></script>

      <script>
        const chatContainer = document.getElementById('chatContainer');
      const minimizeBtn = document.getElementById('minimizeBtn');
      //const maximizeBtn = document.getElementById('maximizeBtn');
      const chatBubble = document.getElementById('chatBubble');
    
      function toggleMinimize() {
        chatContainer.classList.remove('maximized');
        chatContainer.classList.toggle('minimized');
        minimizeBtn.textContent = chatContainer.classList.contains('minimized') ? '‚ñ°' : '_';
        //maximizeBtn.textContent = '‚ñ°';
      }
    
      function toggleMaximize() {
        chatContainer.classList.remove('minimized');
        chatContainer.classList.toggle('maximized');
        //maximizeBtn.textContent = chatContainer.classList.contains('maximized') ? '‚ùê' : '‚ñ°';
        minimizeBtn.textContent = '_';
      }
    
      minimizeBtn.addEventListener('click', toggleMinimize);
      //maximizeBtn.addEventListener('click', toggleMaximize);
    
      chatBubble.addEventListener('click', () => {
        if (chatContainer.classList.contains('minimized')) {
          chatContainer.classList.remove('minimized');
          minimizeBtn.textContent = '_';
        }
      });
      </script>
    </body>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KGJLJB0CMY">
    </script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-KGJLJB0CMY');
    </script>
</html>





